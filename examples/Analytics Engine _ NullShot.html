<!DOCTYPE html>
<!-- saved from url=(0064)https://nullshot.ai/en/docs/developers/platform/analytics-engine -->
<html lang="en" class="__variable_bc0dcf __variable_d28b19 __variable_017788 __variable_2d00a0 __variable_7c1658 __variable_f2a38a __variable_5cfdac __variable_9a8899 light" style="color-scheme: light;"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><link rel="stylesheet" href="./Analytics Engine _ NullShot_files/879b7432ada67782.css" data-precedence="next"><link rel="stylesheet" href="./Analytics Engine _ NullShot_files/e3677c054a3c95bc.css" data-precedence="next"><link rel="preload" as="script" fetchpriority="low" href="./Analytics Engine _ NullShot_files/webpack-c07b3e4c8b34ec25.js"><script src="./Analytics Engine _ NullShot_files/4bd1b696-70766e75de8d31b9.js" async=""></script><script src="./Analytics Engine _ NullShot_files/15964-39035fb27dd00739.js" async=""></script><script src="./Analytics Engine _ NullShot_files/main-app-fe0efc24e47254af.js" async=""></script><script src="./Analytics Engine _ NullShot_files/7d384bb9-0ffedcc6b53f3e73.js" async=""></script><script src="./Analytics Engine _ NullShot_files/cd24890f-ec7b64c510add751.js" async=""></script><script src="./Analytics Engine _ NullShot_files/14081-3a328a513f1860b8.js" async=""></script><script src="./Analytics Engine _ NullShot_files/66766-93aa4a3d196b6d8b.js" async=""></script><script src="./Analytics Engine _ NullShot_files/6874-5100f18710e9cb3f.js" async=""></script><script src="./Analytics Engine _ NullShot_files/61337-fe5b1b874c13fe78.js" async=""></script><script src="./Analytics Engine _ NullShot_files/31928-70a661b25895e6e5.js" async=""></script><script src="./Analytics Engine _ NullShot_files/57875-6609a7eb2a870f03.js" async=""></script><script src="./Analytics Engine _ NullShot_files/37742-88327bccd3a920a3.js" async=""></script><script src="./Analytics Engine _ NullShot_files/89329-9fb50cc5122e0593.js" async=""></script><script src="./Analytics Engine _ NullShot_files/4228-aa6df1d124ddc104.js" async=""></script><script src="./Analytics Engine _ NullShot_files/57220-384f521032e96b7b.js" async=""></script><script src="./Analytics Engine _ NullShot_files/21108-625e01f465d840ea.js" async=""></script><script src="./Analytics Engine _ NullShot_files/layout-daa5c86b9be15eb1.js" async=""></script><script src="./Analytics Engine _ NullShot_files/39526-1f72852a19518691.js" async=""></script><script src="./Analytics Engine _ NullShot_files/81489-364437be73f42e0d.js" async=""></script><script src="./Analytics Engine _ NullShot_files/15042-dde24db1fd73b409.js" async=""></script><script src="./Analytics Engine _ NullShot_files/73317-ed887098e222ed78.js" async=""></script><script src="./Analytics Engine _ NullShot_files/layout-8f83607456863de9.js" async=""></script><script src="./Analytics Engine _ NullShot_files/page-4084506d579935d5.js" async=""></script><script src="./Analytics Engine _ NullShot_files/68679-e7d59f5e228a6339.js" async=""></script><script src="./Analytics Engine _ NullShot_files/layout-7d507a6a998fafbd.js" async=""></script><script src="./Analytics Engine _ NullShot_files/polyfills-42372ed130431b0a.js" nomodule=""></script><link rel="preload" href="https://nullshot.ai/_next/static/media/1dcb4bb6f2068eb9-s.p.woff2" as="font" crossorigin="" type="font/woff2"><link rel="preload" href="https://nullshot.ai/_next/static/media/569ce4b8f30dc480-s.p.woff2" as="font" crossorigin="" type="font/woff2"><link rel="preload" href="https://nullshot.ai/_next/static/media/5ed273b77d2a1951-s.p.woff2" as="font" crossorigin="" type="font/woff2"><link rel="preload" href="https://nullshot.ai/_next/static/media/62a211a97b43f624-s.p.otf" as="font" crossorigin="" type="font/otf"><link rel="preload" href="https://nullshot.ai/_next/static/media/7cba1811e3c25a15-s.p.woff2" as="font" crossorigin="" type="font/woff2"><link rel="preload" href="https://nullshot.ai/_next/static/media/93f479601ee12b01-s.p.woff2" as="font" crossorigin="" type="font/woff2"><link rel="preload" href="https://nullshot.ai/_next/static/media/a67ad81cd994aeef-s.p.otf" as="font" crossorigin="" type="font/otf"><link rel="preload" href="https://nullshot.ai/_next/static/media/ab86f138d0d6e9da-s.p.woff2" as="font" crossorigin="" type="font/woff2"><link rel="preload" href="https://nullshot.ai/_next/static/media/c7f848bed9dd25a3-s.p.woff2" as="font" crossorigin="" type="font/woff2"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="next-size-adjust" content=""><title>Analytics Engine | NullShot</title><meta name="description" content="Time-series data storage for agent performance metrics, billing, and insights"><meta name="application-name" content="NullShot"><meta name="author" content="NullShot Team"><link rel="manifest" href="https://nullshot.ai/manifest.json"><meta name="referrer" content="origin-when-cross-origin"><meta name="creator" content="NullShot"><meta name="publisher" content="NullShot"><meta name="robots" content="index, follow"><meta name="googlebot" content="index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"><meta name="category" content="Technology"><link rel="canonical" href="https://nullshot.ai/en/docs/developers/platform/analytics-engine"><link rel="alternate" hreflang="en" href="https://nullshot.ai/en/docs/developers/platform/analytics-engine"><meta property="og:title" content="Analytics Engine"><meta property="og:description" content="Time-series data storage for agent performance metrics, billing, and insights"><meta property="og:url" content="https://nullshot.ai/en/docs/developers/platform/analytics-engine"><meta property="og:site_name" content="Platform Documentation"><meta property="og:locale" content="en"><meta property="og:image" content="https://nullshot.ai/images/og-image.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="og:image:alt" content="Analytics Engine"><meta property="og:type" content="article"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Analytics Engine"><meta name="twitter:description" content="Time-series data storage for agent performance metrics, billing, and insights"><meta name="twitter:image" content="https://nullshot.ai/images/og-image.png"><link rel="icon" href="https://nullshot.ai/icon.svg?423bbdeb1a002565" type="image/svg+xml" sizes="any"></head><body class="antialiased bg-background font-sans" style="overflow: unset;"><!--$--><!--/$--><script type="text/javascript" crossorigin="anonymous" src="./Analytics Engine _ NullShot_files/web-vitals.js"></script><script type="text/javascript" crossorigin="anonymous" src="./Analytics Engine _ NullShot_files/dead-clicks-autocapture.js"></script><script type="text/javascript" crossorigin="anonymous" src="./Analytics Engine _ NullShot_files/recorder.js"></script><script type="text/javascript" crossorigin="anonymous" src="./Analytics Engine _ NullShot_files/config.js"></script><div hidden=""></div><script>((a2, b2, c2, d2, e2, f2, g2, h2) => {
          let i2 = document.documentElement, j2 = ["light", "dark"];
          function k2(b3) {
            var c3;
            (Array.isArray(a2) ? a2 : [a2]).forEach((a3) => {
              let c4 = a3 === "class", d3 = c4 && f2 ? e2.map((a4) => f2[a4] || a4) : e2;
              c4 ? (i2.classList.remove(...d3), i2.classList.add(f2 && f2[b3] ? f2[b3] : b3)) : i2.setAttribute(a3, b3);
            }), c3 = b3, h2 && j2.includes(c3) && (i2.style.colorScheme = c3);
          }
          __name(k2, "k2");
          if (d2) k2(d2);
          else try {
            let a3 = localStorage.getItem(b2) || c2, d3 = g2 && a3 === "system" ? window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light" : a3;
            k2(d3);
          } catch {
          }
        })("class","theme","system",null,["light","dark"],null,true,true)</script><div class="relative flex min-h-screen flex-col"><div class="relative flex min-h-screen flex-col"><header class="fixed top-0 z-50 w-full" style="background:#222531;border-bottom:1px solid rgba(255, 255, 255, 0.12)"><div class="mx-auto px-4 sm:px-6 lg:px-8 max-w-[1440px]"><div class="hidden md:flex h-16 items-center justify-between px-[80px]"><div class="flex items-center gap-10"><a class="flex items-center gap-6" href="https://nullshot.ai/en"><div class="w-[131px] h-8 relative flex items-center justify-center"><img alt="Nullshot" loading="lazy" width="131" height="32" decoding="async" data-nimg="1" class="object-contain" style="color:transparent" src="./Analytics Engine _ NullShot_files/logo.svg"></div></a><nav class="flex items-center gap-4"><a class="group flex items-center gap-2 font-space-grotesk font-bold text-base transition-all duration-200 text-white/60 hover:text-white hover:nav-glow" href="https://nullshot.ai/exchange"><div class="transition-all duration-200 relative opacity-60 group-hover:opacity-100"><img alt="Exchange" loading="lazy" width="24" height="24" decoding="async" data-nimg="1" class="object-contain" src="./Analytics Engine _ NullShot_files/exchange-icon.svg" style="color: transparent;"></div>Exchange</a><a class="group flex items-center gap-2 font-space-grotesk font-bold text-base transition-all duration-200 text-white/60 hover:text-white hover:nav-glow" href="https://nullshot.ai/playground"><div class="transition-all duration-200 relative opacity-60 group-hover:opacity-100"><img alt="Playground" loading="lazy" width="24" height="24" decoding="async" data-nimg="1" class="object-contain" src="./Analytics Engine _ NullShot_files/playground-icon.svg" style="color: transparent;"></div>Playground</a><a class="group flex items-center gap-2 font-space-grotesk font-bold text-base transition-all duration-200 text-white/60 hover:text-white hover:nav-glow" href="https://nullshot.ai/brainstorm"><div class="transition-all duration-200 relative opacity-60 group-hover:opacity-100"><img alt="Brainstorm" loading="lazy" width="24" height="24" decoding="async" data-nimg="1" class="object-contain" src="./Analytics Engine _ NullShot_files/brainstorm-icon.svg" style="color: transparent;"></div>Brainstorm</a></nav></div><div class="flex items-center gap-4"><a href="https://nullshot.ai/docs"><button class="justify-center whitespace-nowrap transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none [&amp;_svg]:pointer-events-none [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 disabled:!bg-[#1D1F29] disabled:!text-[rgba(255,255,255,0.2)] disabled:!border-[rgba(255,255,255,0.2)] h-10 px-4 py-2 rounded-xl font-bold text-base font-space-grotesk text-white/80 bg-transparent border border-white/20 hover:bg-white/10 hover:border-white/80 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-code h-4 w-4"><path d="M10 12.5 8 15l2 2.5"></path><path d="m14 12.5 2 2.5-2 2.5"></path><path d="M14 2v4a2 2 0 0 0 2 2h4"></path><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7z"></path></svg>Developer Docs</button></a><button class="inline-flex items-center justify-center gap-2 whitespace-nowrap transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none [&amp;_svg]:pointer-events-none [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 bg-primary-gradient hover:bg-primary-gradient-hover disabled:!bg-[#1D1F29] disabled:!text-[rgba(255,255,255,0.2)] disabled:bg-none h-10 px-4 py-2 rounded-xl font-bold text-base font-space-grotesk text-white bg-gradient-to-r from-[#7849EF] to-[#326CD8] hover:opacity-90">Sign In</button></div></div><div class="flex md:hidden h-16 items-center justify-between px-4"><div class="w-8 h-8 flex items-center justify-center"><div class="w-8 h-8"></div></div><a class="flex items-center" href="https://nullshot.ai/en"><div class="w-[98px] h-6 relative flex items-center justify-center"><img alt="Nullshot" loading="lazy" width="98" height="24" decoding="async" data-nimg="1" class="object-contain" style="color:transparent" src="./Analytics Engine _ NullShot_files/logo.svg"></div></a><button class="p-1 flex items-center justify-center" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-_R_1pcnmjb_" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu h-5 w-5 text-white/80 stroke-2"><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg></button></div></div></header><main class="flex-1"><div class="hidden md:flex h-screen bg-[#16171A] pt-16"><div class="w-64 border-r border-white/10 bg-[#16171A] flex-shrink-0 sticky top-16 h-[calc(100vh-4rem)] overflow-y-auto scrollbar-hide"><div class="h-full flex flex-col justify-between"><div class="py-6 px-4 flex-1"><div class="space-y-6"><div class="space-y-3"><h3 class="text-h4-bold text-white/60 tracking-wider px-2 py-1 font-space-grotesk">Introduction</h3><div class="space-y-1 ml-2 mt-3"><div class="flex flex-col"><div class="flex justify-between items-center rounded-[4px] transition-colors hover:bg-[#43475E] group" style="cursor:default"><a class="flex-grow py-1.5 px-4 text-base rounded-[4px] transition-colors font-space-grotesk font-medium text-white group-hover:text-white" href="https://nullshot.ai/en/docs/introduction/overview">Overview</a></div></div><div class="flex flex-col"><div class="flex justify-between items-center rounded-[4px] transition-colors hover:bg-[#43475E] group" style="cursor:pointer"><div class="flex-grow py-1.5 px-4 text-base rounded-[4px] transition-colors font-space-grotesk font-medium text-white group-hover:text-white">Concepts</div><div class="px-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down h-4 w-4 text-white/60 transition-colors group-hover:text-white"><path d="m6 9 6 6 6-6"></path></svg></div></div></div></div></div><div class="space-y-3"><h3 class="text-h4-bold text-white/60 tracking-wider px-2 py-1 font-space-grotesk">Protocol</h3><div class="space-y-1 ml-2 mt-3"><div class="flex flex-col"><div class="flex justify-between items-center rounded-[4px] transition-colors hover:bg-[#43475E] group" style="cursor:default"><a class="flex-grow py-1.5 px-4 text-base rounded-[4px] transition-colors font-space-grotesk font-medium text-white group-hover:text-white" href="https://nullshot.ai/en/docs/protocol/overview">Overview</a></div></div><div class="flex flex-col"><div class="flex justify-between items-center rounded-[4px] transition-colors hover:bg-[#43475E] group" style="cursor:default"><a class="flex-grow py-1.5 px-4 text-base rounded-[4px] transition-colors font-space-grotesk font-medium text-white group-hover:text-white" href="https://nullshot.ai/en/docs/protocol/chains">Chains</a></div></div><div class="flex flex-col"><div class="flex justify-between items-center rounded-[4px] transition-colors hover:bg-[#43475E] group" style="cursor:default"><a class="flex-grow py-1.5 px-4 text-base rounded-[4px] transition-colors font-space-grotesk font-medium text-white group-hover:text-white" href="https://nullshot.ai/en/docs/protocol/xava">XAVA DAO</a></div></div></div></div><div class="space-y-3"><h3 class="text-h4-bold text-white/60 tracking-wider px-2 py-1 font-space-grotesk">Developers</h3><div class="space-y-1 ml-2 mt-3"><div class="flex flex-col"><div class="flex justify-between items-center rounded-[4px] transition-colors hover:bg-[#43475E] group" style="cursor:pointer"><a class="flex-grow py-1.5 px-4 text-base rounded-[4px] transition-colors font-space-grotesk font-medium text-white group-hover:text-white" href="https://nullshot.ai/en/docs/developers/platform/overview">Platform</a><div class="px-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down h-4 w-4 text-white/60 transition-colors group-hover:text-white transform rotate-180"><path d="m6 9 6 6 6-6"></path></svg></div></div><div class="mt-1 ml-2 relative"><div class="absolute left-3 top-0 bottom-0 w-[2px] bg-white/20 overflow-hidden"><div class="absolute left-0 w-full h-6 bg-gradient-to-b from-[#997EDE] to-[#77A7FF] transition-transform duration-200 ease-in-out" style="transform: translateY(34px);"></div></div><div class="pl-4 space-y-1"><a class="h-7 flex items-center px-4 text-sm rounded-[4px] transition-colors font-space-grotesk relative text-white/60 hover:bg-[#43475E] hover:text-white" href="https://nullshot.ai/en/docs/developers/platform/overview">Overview</a><a class="h-7 flex items-center px-4 text-sm rounded-[4px] transition-colors font-space-grotesk relative font-medium bg-gradient-to-r from-[#997EDE] to-[#77A7FF] bg-clip-text text-transparent" href="https://nullshot.ai/en/docs/developers/platform/analytics-engine">Analytics Engine</a><a class="h-7 flex items-center px-4 text-sm rounded-[4px] transition-colors font-space-grotesk relative text-white/60 hover:bg-[#43475E] hover:text-white" href="https://nullshot.ai/en/docs/developers/platform/cache">Cache</a><a class="h-7 flex items-center px-4 text-sm rounded-[4px] transition-colors font-space-grotesk relative text-white/60 hover:bg-[#43475E] hover:text-white" href="https://nullshot.ai/en/docs/developers/platform/environment-variables">Environment Variables</a><a class="h-7 flex items-center px-4 text-sm rounded-[4px] transition-colors font-space-grotesk relative text-white/60 hover:bg-[#43475E] hover:text-white" href="https://nullshot.ai/en/docs/developers/platform/memory-store">Memory Store (KV)</a><a class="h-7 flex items-center px-4 text-sm rounded-[4px] transition-colors font-space-grotesk relative text-white/60 hover:bg-[#43475E] hover:text-white" href="https://nullshot.ai/en/docs/developers/platform/queues">Queues</a><a class="h-7 flex items-center px-4 text-sm rounded-[4px] transition-colors font-space-grotesk relative text-white/60 hover:bg-[#43475E] hover:text-white" href="https://nullshot.ai/en/docs/developers/platform/secret-manager">Secret Manager</a><a class="h-7 flex items-center px-4 text-sm rounded-[4px] transition-colors font-space-grotesk relative text-white/60 hover:bg-[#43475E] hover:text-white" href="https://nullshot.ai/en/docs/developers/platform/storage">Storage (R2/S3)</a><a class="h-7 flex items-center px-4 text-sm rounded-[4px] transition-colors font-space-grotesk relative text-white/60 hover:bg-[#43475E] hover:text-white" href="https://nullshot.ai/en/docs/developers/platform/web-search">Browser Rendering</a><a class="h-7 flex items-center px-4 text-sm rounded-[4px] transition-colors font-space-grotesk relative text-white/60 hover:bg-[#43475E] hover:text-white" href="https://nullshot.ai/en/docs/developers/platform/workflows">Workflows</a><a class="h-7 flex items-center px-4 text-sm rounded-[4px] transition-colors font-space-grotesk relative text-white/60 hover:bg-[#43475E] hover:text-white" href="https://nullshot.ai/en/docs/developers/platform/d1-database">SQL Database</a><a class="h-7 flex items-center px-4 text-sm rounded-[4px] transition-colors font-space-grotesk relative text-white/60 hover:bg-[#43475E] hover:text-white" href="https://nullshot.ai/en/docs/developers/platform/vectorize">Vectorize</a></div></div></div><div class="flex flex-col"><div class="flex justify-between items-center rounded-[4px] transition-colors hover:bg-[#43475E] group" style="cursor:pointer"><a class="flex-grow py-1.5 px-4 text-base rounded-[4px] transition-colors font-space-grotesk font-medium text-white group-hover:text-white" href="https://nullshot.ai/en/docs/developers/agents-framework/overview">Agents Framework</a><div class="px-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down h-4 w-4 text-white/60 transition-colors group-hover:text-white"><path d="m6 9 6 6 6-6"></path></svg></div></div></div><div class="flex flex-col"><div class="flex justify-between items-center rounded-[4px] transition-colors hover:bg-[#43475E] group" style="cursor:pointer"><a class="flex-grow py-1.5 px-4 text-base rounded-[4px] transition-colors font-space-grotesk font-medium text-white group-hover:text-white" href="https://nullshot.ai/en/docs/developers/mcp-framework/overview">Mcp Framework</a><div class="px-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down h-4 w-4 text-white/60 transition-colors group-hover:text-white"><path d="m6 9 6 6 6-6"></path></svg></div></div></div><div class="flex flex-col"><div class="flex justify-between items-center rounded-[4px] transition-colors hover:bg-[#43475E] group" style="cursor:pointer"><a class="flex-grow py-1.5 px-4 text-base rounded-[4px] transition-colors font-space-grotesk font-medium text-white group-hover:text-white" href="https://nullshot.ai/en/docs/developers/services/overview">Services</a><div class="px-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down h-4 w-4 text-white/60 transition-colors group-hover:text-white"><path d="m6 9 6 6 6-6"></path></svg></div></div></div><div class="flex flex-col"><div class="flex justify-between items-center rounded-[4px] transition-colors hover:bg-[#43475E] group" style="cursor:default"><a class="flex-grow py-1.5 px-4 text-base rounded-[4px] transition-colors font-space-grotesk font-medium text-white group-hover:text-white" href="https://nullshot.ai/en/docs/developers/playground">Playground</a></div></div></div></div></div></div><div class="border-t border-white/12 p-4"><div class="space-y-2"><a href="https://discord.gg/acwpp6zWEc" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 py-1.5 text-sm text-white/80 hover:text-white font-space-grotesk"><span class="h-4 w-4 opacity-60"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor"><path d="M13.545 2.907a13.227 13.227 0 0 0-3.257-1.011.05.05 0 0 0-.052.025c-.141.25-.297.577-.406.833a12.19 12.19 0 0 0-3.658 0 8.258 8.258 0 0 0-.412-.833.051.051 0 0 0-.052-.025c-1.125.194-2.22.534-3.257 1.011a.041.041 0 0 0-.021.018C.356 6.024-.213 9.047.066 12.032c.001.014.01.028.021.037a13.276 13.276 0 0 0 3.995 2.02.05.05 0 0 0 .056-.019c.308-.42.582-.863.818-1.329a.05.05 0 0 0-.01-.059.051.051 0 0 0-.018-.011 8.875 8.875 0 0 1-1.248-.595.05.05 0 0 1-.02-.066.051.051 0 0 1 .015-.019c.084-.063.168-.129.248-.195a.05.05 0 0 1 .051-.007c2.619 1.196 5.454 1.196 8.041 0a.052.052 0 0 1 .053.007c.08.066.164.132.248.195a.051.051 0 0 1-.004.085 8.254 8.254 0 0 1-1.249.594.05.05 0 0 0-.03.03.052.052 0 0 0 .003.041c.24.465.515.909.817 1.329a.05.05 0 0 0 .056.019 13.235 13.235 0 0 0 4.001-2.02.049.049 0 0 0 .021-.037c.334-3.451-.559-6.449-2.366-9.106a.034.034 0 0 0-.02-.019Zm-8.198 7.307c-.789 0-1.438-.724-1.438-1.612 0-.889.637-1.613 1.438-1.613.807 0 1.45.73 1.438 1.613 0 .888-.637 1.612-1.438 1.612Zm5.316 0c-.788 0-1.438-.724-1.438-1.612 0-.889.637-1.613 1.438-1.613.807 0 1.451.73 1.438 1.613 0 .888-.631 1.612-1.438 1.612Z"></path></svg></span>Discord</a><a href="https://github.com/null-shot" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 py-1.5 text-sm text-white/80 hover:text-white font-space-grotesk"><span class="h-4 w-4 opacity-60"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg></span>Github</a><a href="https://x.com/_nullshot_" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 py-1.5 text-sm text-white/80 hover:text-white font-space-grotesk"><span class="h-4 w-4 opacity-60"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z"></path></svg></span>Twitter</a><a href="https://t.me/nullshotai" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 py-1.5 text-sm text-white/80 hover:text-white font-space-grotesk"><span class="h-4 w-4 opacity-60"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"></path></svg></span>Telegram</a></div></div></div></div><div id="docs-main-content" class="flex-1 overflow-y-auto scrollbar-hide"><div class="min-h-screen"><!--$--><!--/$--><div class="md:py-12"><div class="max-w-4xl mx-auto px-4 md:px-6"><div class="md:border md:border-white/20 md:rounded-xl p-4 md:p-8 bg-[#16171A]"><div class="mb-8"><h1 class="text-4xl font-bold leading-tight text-white mb-3 font-space-grotesk">Analytics Engine</h1></div><div class="prose prose-invert prose-headings:text-white/90 prose-p:text-white/80 prose-a:text-blue-400 max-w-none prose-pre:p-0 prose-pre:bg-transparent prose-code:bg-transparent prose-code:p-0"><div class="mdx-content"><p class="text-white/80 mb-4 font-space-grotesk"><strong>Turn your agent data into actionable insights.</strong> Analytics Engine is a time-series database optimized for storing and querying metrics at massive scale. Perfect for tracking agent performance, user engagement, billing data, trading data, and generating real-time dashboards.</p>
<h2 id="key-features" class="text-xl font-bold text-white/90 mt-8 mb-4 font-space-grotesk">Key Features</h2>
<ul class="list-disc pl-6 space-y-2 mb-4 text-white/80 font-space-grotesk">
<li class="text-white/80 font-space-grotesk"><strong>Time-Series Optimized</strong>: Built for high-frequency metric ingestion with 90 day retention</li>
<li class="text-white/80 font-space-grotesk"><strong>SQL Querying</strong>: Use familiar SQL to analyze your data</li>
<li class="text-white/80 font-space-grotesk"><strong>Real-Time Analytics</strong>: Query data as soon as it's written</li>
<li class="text-white/80 font-space-grotesk"><strong>Cost Effective</strong>: Pay only for data points written, not storage</li>
<li class="text-white/80 font-space-grotesk"><strong>Global Distribution</strong>: Data available worldwide with low latency</li>
</ul>
<p class="text-white/80 mb-4 font-space-grotesk"><em>NOTE: If you are looking for longer storage retention, consider <a class="text-[#7E98FF] hover:text-[#7E98FF] hover:underline font-space-grotesk" href="https://nullshot.ai/en/developers/platform/d1-database">SQL Database</a> combined with caching techniques to achieve similar results.</em></p>
<h2 id="getting-started" class="text-xl font-bold text-white/90 mt-8 mb-4 font-space-grotesk">Getting Started</h2>
<h3 class="text-l font-semibold text-white/90 mt-6 mb-3 font-space-grotesk" id="wrangler-configuration-2">Wrangler Configuration</h3>
<p class="text-white/80 mb-4 font-space-grotesk">First, add analytics in your <code class="bg-black/50 px-1 py-0.5 rounded text-green-400 font-mono text-sm">wrangler.json</code>:</p>
<div class="code-block-container relative group my-6"><div class="flex items-center justify-between bg-[#1e1e1e] border border-white/10 border-b-0 rounded-t-lg px-4 py-2 text-sm"><span class="text-white/60 font-mono text-xs uppercase tracking-wider">json</span><button class="flex items-center gap-1.5 px-2 py-1 rounded text-xs transition-all duration-200 hover:bg-white/10 text-white/60 hover:text-white/80 focus:outline-none focus:ring-2 focus:ring-blue-500/50" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy h-3 w-3"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><div class="code-block-content bg-[#1e1e1e] border border-white/10 border-t-0 rounded-b-lg"><pre class="react-syntax-highlighter" style="color: rgb(212, 212, 212); font-size: 0.875rem; text-shadow: none; font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 4; hyphens: none; padding: 1rem; margin: 0px; overflow: visible; background: transparent; border-radius: 0.5rem; max-width: 100%;"><code style="white-space: pre-wrap; font-size: 0.875rem; line-height: 1.5; font-family: var(--font-geist-mono), Monaco, &quot;Cascadia Code&quot;, &quot;Roboto Mono&quot;, Consolas, &quot;Courier New&quot;, monospace; word-break: break-word;"><span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(156, 220, 254);">"analytics_engine_datasets"</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">[</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(156, 220, 254);">"binding"</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">"ANALYTICS"</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(156, 220, 254);">"dataset"</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">"agent_metrics"</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">]</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span></span></code></pre></div></div>
<h3 class="text-l font-semibold text-white/90 mt-6 mb-3 font-space-grotesk" id="agent-integration-3">Agent Integration</h3>
<p class="text-white/80 mb-4 font-space-grotesk">Access analytics through your agent's environment and start tracking basic metrics:</p>
<div class="code-block-container relative group my-6"><div class="flex items-center justify-between bg-[#1e1e1e] border border-white/10 border-b-0 rounded-t-lg px-4 py-2 text-sm"><span class="text-white/60 font-mono text-xs uppercase tracking-wider">typescript</span><button class="flex items-center gap-1.5 px-2 py-1 rounded text-xs transition-all duration-200 hover:bg-white/10 text-white/60 hover:text-white/80 focus:outline-none focus:ring-2 focus:ring-blue-500/50" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy h-3 w-3"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><div class="code-block-content bg-[#1e1e1e] border border-white/10 border-t-0 rounded-b-lg"><pre class="react-syntax-highlighter" style="color: rgb(212, 212, 212); font-size: 0.875rem; text-shadow: none; font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 4; hyphens: none; padding: 1rem; margin: 0px; overflow: visible; background: transparent; border-radius: 0.5rem; max-width: 100%;"><code style="white-space: pre-wrap; font-size: 0.875rem; line-height: 1.5; font-family: var(--font-geist-mono), Monaco, &quot;Cascadia Code&quot;, &quot;Roboto Mono&quot;, Consolas, &quot;Courier New&quot;, monospace; word-break: break-word;"><span><span class="token" style="color: rgb(106, 153, 85);">// src/agents/AnalyticsAgent.ts</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(197, 134, 192);">import</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span class="token"> </span><span class="token" style="color: rgb(156, 220, 254);">AiAgentSDK</span><span class="token"> </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">from</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'@typescript-agent-framework/core'</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(197, 134, 192);">export</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">class</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">AnalyticsAgent</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">extends</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">AiAgentSDK</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(220, 220, 170);">constructor</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>env</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">Env</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(86, 156, 214);">super</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>env</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">async</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">processMessage</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>sessionId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> messages</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">AIUISDKMessage</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Promise</span><span class="token" style="color: rgb(212, 212, 212);">&lt;</span><span class="token" style="color: rgb(78, 201, 176);">AgentResponse</span><span class="token" style="color: rgb(212, 212, 212);">&gt;</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> </span><span class="token" style="color: rgb(156, 220, 254);">ANALYTICS</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">this</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">env</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> startTime </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Date</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">now</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>    
</span><span><span>    </span><span class="token" style="color: rgb(106, 153, 85);">// Track message received</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(156, 220, 254);">ANALYTICS</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'agent_metrics'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        agentId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'analytics-demo'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        userId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        messageType</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'user_message'</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        messages_received</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">1</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        message_length</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">content</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">length</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>    
</span><span><span>    </span><span class="token" style="color: rgb(106, 153, 85);">// Process the message</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> response </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">this</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">generateResponse</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">content</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> processingTime </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Date</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">now</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">-</span><span> startTime</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>    
</span><span><span>    </span><span class="token" style="color: rgb(106, 153, 85);">// Track processing metrics</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(156, 220, 254);">ANALYTICS</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'agent_metrics'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        agentId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'analytics-demo'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        userId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        success</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'true'</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        processing_time_ms</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> processingTime</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        responses_generated</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">1</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>    
</span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">return</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> response </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span></span></code></pre></div></div>
<h3 class="text-l font-semibold text-white/90 mt-6 mb-3 font-space-grotesk" id="basic-query-example-4">Basic Query Example</h3>
<p class="text-white/80 mb-4 font-space-grotesk">Query your analytics data using SQL to extract meaningful insights:</p>
<div class="code-block-container relative group my-6"><div class="flex items-center justify-between bg-[#1e1e1e] border border-white/10 border-b-0 rounded-t-lg px-4 py-2 text-sm"><span class="text-white/60 font-mono text-xs uppercase tracking-wider">typescript</span><button class="flex items-center gap-1.5 px-2 py-1 rounded text-xs transition-all duration-200 hover:bg-white/10 text-white/60 hover:text-white/80 focus:outline-none focus:ring-2 focus:ring-blue-500/50" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy h-3 w-3"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><div class="code-block-content bg-[#1e1e1e] border border-white/10 border-t-0 rounded-b-lg"><pre class="react-syntax-highlighter" style="color: rgb(212, 212, 212); font-size: 0.875rem; text-shadow: none; font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 4; hyphens: none; padding: 1rem; margin: 0px; overflow: visible; background: transparent; border-radius: 0.5rem; max-width: 100%;"><code style="white-space: pre-wrap; font-size: 0.875rem; line-height: 1.5; font-family: var(--font-geist-mono), Monaco, &quot;Cascadia Code&quot;, &quot;Roboto Mono&quot;, Consolas, &quot;Courier New&quot;, monospace; word-break: break-word;"><span><span class="token" style="color: rgb(106, 153, 85);">// Query recent performance metrics</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(86, 156, 214);">async</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">function</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">getRecentMetrics</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>analytics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">Analytics</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Promise</span><span class="token" style="color: rgb(212, 212, 212);">&lt;</span><span class="token" style="color: rgb(206, 145, 120);">any</span><span class="token" style="color: rgb(212, 212, 212);">[</span><span class="token" style="color: rgb(212, 212, 212);">]</span><span class="token" style="color: rgb(212, 212, 212);">&gt;</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> oneHourAgo </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Date</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">now</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">-</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(181, 206, 168);">60</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">*</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">60</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">*</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">1000</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> query </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">    SELECT 
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      agentId,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      COUNT(*) as total_messages,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      AVG(processing_time_ms) as avg_processing_time
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    FROM agent_metrics 
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">    WHERE timestamp &gt;= </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">oneHourAgo</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">      AND success = 'true'
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    GROUP BY agentId
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    ORDER BY total_messages DESC
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">  </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> result </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">query</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>query</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">return</span><span> result</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">data</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span></span></code></pre></div></div>
<h3 class="text-l font-semibold text-white/90 mt-6 mb-3 font-space-grotesk" id="mcp-integration-5">MCP Integration</h3>
<div class="code-block-container relative group my-6"><div class="flex items-center justify-between bg-[#1e1e1e] border border-white/10 border-b-0 rounded-t-lg px-4 py-2 text-sm"><span class="text-white/60 font-mono text-xs uppercase tracking-wider">typescript</span><button class="flex items-center gap-1.5 px-2 py-1 rounded text-xs transition-all duration-200 hover:bg-white/10 text-white/60 hover:text-white/80 focus:outline-none focus:ring-2 focus:ring-blue-500/50" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy h-3 w-3"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><div class="code-block-content bg-[#1e1e1e] border border-white/10 border-t-0 rounded-b-lg"><pre class="react-syntax-highlighter" style="color: rgb(212, 212, 212); font-size: 0.875rem; text-shadow: none; font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 4; hyphens: none; padding: 1rem; margin: 0px; overflow: visible; background: transparent; border-radius: 0.5rem; max-width: 100%;"><code style="white-space: pre-wrap; font-size: 0.875rem; line-height: 1.5; font-family: var(--font-geist-mono), Monaco, &quot;Cascadia Code&quot;, &quot;Roboto Mono&quot;, Consolas, &quot;Courier New&quot;, monospace; word-break: break-word;"><span><span class="token" style="color: rgb(106, 153, 85);">// src/mcp/AnalyticsMCPServer.ts</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(197, 134, 192);">import</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span class="token"> </span><span class="token" style="color: rgb(156, 220, 254);">MCPServerDO</span><span class="token"> </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">from</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'@typescript-agent-framework/mcp'</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(197, 134, 192);">export</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">class</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">AnalyticsMCPServer</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">extends</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">MCPServerDO</span><span class="token" style="color: rgb(212, 212, 212);">&lt;</span><span class="token" style="color: rgb(78, 201, 176);">Env</span><span class="token" style="color: rgb(212, 212, 212);">&gt;</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(220, 220, 170);">constructor</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>state</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">DurableObjectState</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> env</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">Env</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(86, 156, 214);">super</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>state</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> env</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>
</span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">protected</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">configureServer</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">return</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      </span><span class="token string-property" style="color: rgb(156, 220, 254);">'track-event'</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">async</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> event</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> dimensions</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> metrics </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> 
</span></span><span><span>        event</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span> 
</span></span><span><span>        dimensions</span><span class="token" style="color: rgb(212, 212, 212);">?</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">Record</span><span class="token" style="color: rgb(212, 212, 212);">&lt;</span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">&gt;</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span> 
</span></span><span><span>        metrics</span><span class="token" style="color: rgb(212, 212, 212);">?</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">Record</span><span class="token" style="color: rgb(212, 212, 212);">&lt;</span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">number</span><span class="token" style="color: rgb(212, 212, 212);">&gt;</span><span> 
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">=&gt;</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> </span><span class="token" style="color: rgb(156, 220, 254);">ANALYTICS</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">this</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">env</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>        
</span><span><span>        </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(156, 220, 254);">ANALYTICS</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'mcp_events'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>          dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>            event_type</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> event</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>            source</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'mcp-server'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>            </span><span class="token spread" style="color: rgb(212, 212, 212);">...</span><span>dimensions
</span></span><span><span>          </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>          metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>            event_count</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">1</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>            </span><span class="token spread" style="color: rgb(212, 212, 212);">...</span><span>metrics
</span></span><span><span>          </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>        
</span><span><span>        </span><span class="token" style="color: rgb(197, 134, 192);">return</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>          success</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">true</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>          message</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token template-string" style="color: rgb(206, 145, 120);">Tracked event: </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">event</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>          timestamp</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Date</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">now</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span>      
</span><span><span>      </span><span class="token string-property" style="color: rgb(156, 220, 254);">'query-metrics'</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">async</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> sql </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> sql</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">=&gt;</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> </span><span class="token" style="color: rgb(156, 220, 254);">ANALYTICS</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">this</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">env</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>        
</span><span><span>        </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> result </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(156, 220, 254);">ANALYTICS</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">query</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>sql</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(197, 134, 192);">return</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>          success</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">true</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>          data</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> result</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">data</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>          rowCount</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> result</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">data</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">length</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span></span></code></pre></div></div>
<h2 id="typescript-api-reference" class="text-xl font-bold text-white/90 mt-8 mb-4 font-space-grotesk">TypeScript API Reference</h2>
<p class="text-white/80 mb-4 font-space-grotesk">You can access the analytics API via the <code class="bg-black/50 px-1 py-0.5 rounded text-green-400 font-mono text-sm">env</code> of the <strong>Agent</strong> or <strong>MCP Tool</strong>:</p>
<div class="code-block-container relative group my-6"><div class="flex items-center justify-between bg-[#1e1e1e] border border-white/10 border-b-0 rounded-t-lg px-4 py-2 text-sm"><span class="text-white/60 font-mono text-xs uppercase tracking-wider">typescript</span><button class="flex items-center gap-1.5 px-2 py-1 rounded text-xs transition-all duration-200 hover:bg-white/10 text-white/60 hover:text-white/80 focus:outline-none focus:ring-2 focus:ring-blue-500/50" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy h-3 w-3"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><div class="code-block-content bg-[#1e1e1e] border border-white/10 border-t-0 rounded-b-lg"><pre class="react-syntax-highlighter" style="color: rgb(212, 212, 212); font-size: 0.875rem; text-shadow: none; font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 4; hyphens: none; padding: 1rem; margin: 0px; overflow: visible; background: transparent; border-radius: 0.5rem; max-width: 100%;"><code style="white-space: pre-wrap; font-size: 0.875rem; line-height: 1.5; font-family: var(--font-geist-mono), Monaco, &quot;Cascadia Code&quot;, &quot;Roboto Mono&quot;, Consolas, &quot;Courier New&quot;, monospace; word-break: break-word;"><span><span class="token" style="color: rgb(106, 153, 85);">// Example function that resides within any Agent or MCP Tool</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(86, 156, 214);">function</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">example</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// ANALYTICS can be named to anything and equals the binding in wrangler.json</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> </span><span class="token" style="color: rgb(156, 220, 254);">ANALYTICS</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">this</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">env</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span></span></code></pre></div></div>
<h3 class="text-l font-semibold text-white/90 mt-6 mb-3 font-space-grotesk" id="data-writing-methods-7">Data Writing Methods</h3>
<p class="text-white/80 mb-4 font-space-grotesk"><strong><code class="bg-black/50 px-1 py-0.5 rounded text-green-400 font-mono text-sm">writeDataPoint(dataset: string, data: AnalyticsDataPoint): Promise&lt;void&gt;</code></strong><br>
Writes a single data point to the specified dataset. Use for individual events or metrics.</p>
<p class="text-white/80 mb-4 font-space-grotesk"><strong><code class="bg-black/50 px-1 py-0.5 rounded text-green-400 font-mono text-sm">writeDataPoints(dataset: string, data: AnalyticsDataPoint[]): Promise&lt;void&gt;</code></strong><br>
Writes multiple data points in a single batch operation. More efficient for bulk data ingestion.</p>
<h3 class="text-l font-semibold text-white/90 mt-6 mb-3 font-space-grotesk" id="query-methods-8">Query Methods</h3>
<p class="text-white/80 mb-4 font-space-grotesk"><strong><code class="bg-black/50 px-1 py-0.5 rounded text-green-400 font-mono text-sm">query(sql: string): Promise&lt;AnalyticsQueryResult&gt;</code></strong><br>
Executes a SQL query against your analytics data. Returns structured results with metadata.</p>
<p class="text-white/80 mb-4 font-space-grotesk"><strong><code class="bg-black/50 px-1 py-0.5 rounded text-green-400 font-mono text-sm">getMetrics(dataset: string, options: MetricsOptions): Promise&lt;MetricsResult&gt;</code></strong><br>
Predefined query helper for common metric aggregations with time ranges and grouping.</p>
<p class="text-white/80 mb-4 font-space-grotesk"><strong><code class="bg-black/50 px-1 py-0.5 rounded text-green-400 font-mono text-sm">getTimeSeries(dataset: string, metric: string, options: TimeSeriesOptions): Promise&lt;TimeSeriesResult&gt;</code></strong><br>
Specialized query for time-series data with automatic interval bucketing.</p>
<h3 class="text-l font-semibold text-white/90 mt-6 mb-3 font-space-grotesk" id="data-structures-9">Data Structures</h3>
<div class="code-block-container relative group my-6"><div class="flex items-center justify-between bg-[#1e1e1e] border border-white/10 border-b-0 rounded-t-lg px-4 py-2 text-sm"><span class="text-white/60 font-mono text-xs uppercase tracking-wider">typescript</span><button class="flex items-center gap-1.5 px-2 py-1 rounded text-xs transition-all duration-200 hover:bg-white/10 text-white/60 hover:text-white/80 focus:outline-none focus:ring-2 focus:ring-blue-500/50" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy h-3 w-3"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><div class="code-block-content bg-[#1e1e1e] border border-white/10 border-t-0 rounded-b-lg"><pre class="react-syntax-highlighter" style="color: rgb(212, 212, 212); font-size: 0.875rem; text-shadow: none; font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 4; hyphens: none; padding: 1rem; margin: 0px; overflow: visible; background: transparent; border-radius: 0.5rem; max-width: 100%;"><code style="white-space: pre-wrap; font-size: 0.875rem; line-height: 1.5; font-family: var(--font-geist-mono), Monaco, &quot;Cascadia Code&quot;, &quot;Roboto Mono&quot;, Consolas, &quot;Courier New&quot;, monospace; word-break: break-word;"><span><span class="token" style="color: rgb(86, 156, 214);">interface</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">AnalyticsDataPoint</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Required fields</span><span>
</span></span><span><span>  timestamp</span><span class="token" style="color: rgb(212, 212, 212);">?</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">number</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>           </span><span class="token" style="color: rgb(106, 153, 85);">// Unix timestamp (defaults to now)</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Optional dimensions (for grouping)</span><span>
</span></span><span><span>  dimensions</span><span class="token" style="color: rgb(212, 212, 212);">?</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    userId</span><span class="token" style="color: rgb(212, 212, 212);">?</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>    agentId</span><span class="token" style="color: rgb(212, 212, 212);">?</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>    messageType</span><span class="token" style="color: rgb(212, 212, 212);">?</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">[</span><span>key</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">]</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">|</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">number</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">|</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">boolean</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Metrics (numeric values)</span><span>
</span></span><span><span>  metrics</span><span class="token" style="color: rgb(212, 212, 212);">?</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    count</span><span class="token" style="color: rgb(212, 212, 212);">?</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">number</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>    duration</span><span class="token" style="color: rgb(212, 212, 212);">?</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">number</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>    tokens</span><span class="token" style="color: rgb(212, 212, 212);">?</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">number</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>    cost</span><span class="token" style="color: rgb(212, 212, 212);">?</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">number</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">[</span><span>key</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">]</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">number</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(86, 156, 214);">interface</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">MetricsOptions</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  timeRange</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    start</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">number</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>              </span><span class="token" style="color: rgb(106, 153, 85);">// Unix timestamp</span><span>
</span></span><span><span>    end</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">number</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>                </span><span class="token" style="color: rgb(106, 153, 85);">// Unix timestamp</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  dimensions</span><span class="token" style="color: rgb(212, 212, 212);">?</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">[</span><span class="token" style="color: rgb(212, 212, 212);">]</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>        </span><span class="token" style="color: rgb(106, 153, 85);">// Group by these dimensions</span><span>
</span></span><span><span>  metrics</span><span class="token" style="color: rgb(212, 212, 212);">?</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">[</span><span class="token" style="color: rgb(212, 212, 212);">]</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>           </span><span class="token" style="color: rgb(106, 153, 85);">// Include these metrics</span><span>
</span></span><span><span>  interval</span><span class="token" style="color: rgb(212, 212, 212);">?</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>            </span><span class="token" style="color: rgb(106, 153, 85);">// '1m', '5m', '1h', '1d'</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span></span></code></pre></div></div>
<h2 id="examples" class="text-xl font-bold text-white/90 mt-8 mb-4 font-space-grotesk">Examples</h2>
<p class="text-white/80 mb-4 font-space-grotesk">Each example demonstrates different analytics patterns for monitoring agent performance, billing tracking, A/B testing, and real-time system monitoring.</p>
<h3 class="text-l font-semibold text-white/90 mt-6 mb-3 font-space-grotesk" id="performance-monitoring-agent-11">Performance Monitoring Agent</h3>
<p class="text-white/80 mb-4 font-space-grotesk">Comprehensive agent performance tracking with error handling and user satisfaction metrics:</p>
<div class="code-block-container relative group my-6"><div class="flex items-center justify-between bg-[#1e1e1e] border border-white/10 border-b-0 rounded-t-lg px-4 py-2 text-sm"><span class="text-white/60 font-mono text-xs uppercase tracking-wider">typescript</span><button class="flex items-center gap-1.5 px-2 py-1 rounded text-xs transition-all duration-200 hover:bg-white/10 text-white/60 hover:text-white/80 focus:outline-none focus:ring-2 focus:ring-blue-500/50" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy h-3 w-3"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><div class="code-block-content bg-[#1e1e1e] border border-white/10 border-t-0 rounded-b-lg"><pre class="react-syntax-highlighter" style="color: rgb(212, 212, 212); font-size: 0.875rem; text-shadow: none; font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 4; hyphens: none; padding: 1rem; margin: 0px; overflow: visible; background: transparent; border-radius: 0.5rem; max-width: 100%;"><code style="white-space: pre-wrap; font-size: 0.875rem; line-height: 1.5; font-family: var(--font-geist-mono), Monaco, &quot;Cascadia Code&quot;, &quot;Roboto Mono&quot;, Consolas, &quot;Courier New&quot;, monospace; word-break: break-word;"><span><span class="token" style="color: rgb(106, 153, 85);">// Agent that tracks its own performance metrics</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(197, 134, 192);">export</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">async</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">function</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">processMessage</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>
</span></span><span><span>  sessionId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> messages</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">AIUISDKMessage</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>  platform</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">PlatformServices</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Promise</span><span class="token" style="color: rgb(212, 212, 212);">&lt;</span><span class="token" style="color: rgb(78, 201, 176);">AgentResponse</span><span class="token" style="color: rgb(212, 212, 212);">&gt;</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> memoryStore </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> platform</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> startTime </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Date</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">now</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">try</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(106, 153, 85);">// Step 1: Track incoming message metrics</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'agent_metrics'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        agentId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'performance-monitor'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        userId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        messageType</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">detectMessageType</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">content</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(106, 153, 85);">// "question", "command", "chat"</span><span>
</span></span><span><span>        source</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">metadata</span><span class="token" style="color: rgb(212, 212, 212);">?.</span><span>source </span><span class="token" style="color: rgb(212, 212, 212);">||</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'unknown'</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        messages_received</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">1</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        message_length</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">content</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">length</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>    
</span><span><span>    </span><span class="token" style="color: rgb(106, 153, 85);">// Step 2: Process the message (business logic)</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> response </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">generateResponse</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">content</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> processingTime </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Date</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">now</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">-</span><span> startTime</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>    
</span><span><span>    </span><span class="token" style="color: rgb(106, 153, 85);">// Step 3: Track successful response metrics</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'agent_metrics'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        agentId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'performance-monitor'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        userId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        messageType</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">detectMessageType</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">content</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        success</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'true'</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        responses_generated</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">1</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        processing_time_ms</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> processingTime</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        response_length</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> response</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">length</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        tokens_consumed</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">estimateTokens</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">content</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">+</span><span> response</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>    
</span><span><span>    </span><span class="token" style="color: rgb(106, 153, 85);">// Step 4: Track user satisfaction if feedback provided</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">if</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">metadata</span><span class="token" style="color: rgb(212, 212, 212);">?.</span><span>feedback</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'user_satisfaction'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>          agentId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'performance-monitor'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>          userId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>          rating</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">metadata</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">feedback</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">rating</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">toString</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(106, 153, 85);">// "1-5"</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>          satisfaction_score</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">metadata</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">feedback</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">rating</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>          feedback_count</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">1</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>    
</span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">return</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> response </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>    
</span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">catch</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>error</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> processingTime </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Date</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">now</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">-</span><span> startTime</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>    
</span><span><span>    </span><span class="token" style="color: rgb(106, 153, 85);">// Step 5: Track error metrics for debugging</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'agent_metrics'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        agentId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'performance-monitor'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        userId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        messageType</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">detectMessageType</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">content</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        success</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'false'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        error_type</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> error</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">name</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">||</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'unknown'</span><span> </span><span class="token" style="color: rgb(106, 153, 85);">// "TimeoutError", "ValidationError", etc.</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        errors_count</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">1</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        processing_time_ms</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> processingTime
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>    
</span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">throw</span><span> error</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(106, 153, 85);">// Analytics dashboard query agent</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(197, 134, 192);">export</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">async</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">function</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">generatePerformanceReport</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>
</span></span><span><span>  timeRange</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> start</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">number</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span> end</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">number</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>  platform</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">PlatformServices</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Promise</span><span class="token" style="color: rgb(212, 212, 212);">&lt;</span><span class="token" style="color: rgb(78, 201, 176);">PerformanceReport</span><span class="token" style="color: rgb(212, 212, 212);">&gt;</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> analytics </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> platform</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Query 1: Get overall performance metrics</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> performanceQuery </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">    SELECT 
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      agentId,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      COUNT(*) as total_messages,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      AVG(processing_time_ms) as avg_processing_time,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      SUM(CASE WHEN success = 'true' THEN 1 ELSE 0 END) as successful_messages,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      SUM(CASE WHEN success = 'false' THEN 1 ELSE 0 END) as failed_messages,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      AVG(tokens_consumed) as avg_tokens
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    FROM agent_metrics 
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">    WHERE timestamp &gt;= </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">timeRange</span><span class="token template-string" style="color: rgb(212, 212, 212);">.</span><span class="token template-string property-access" style="color: rgb(156, 220, 254);">start</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);"> AND timestamp &lt;= </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">timeRange</span><span class="token template-string" style="color: rgb(212, 212, 212);">.</span><span class="token template-string property-access" style="color: rgb(156, 220, 254);">end</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">    GROUP BY agentId
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    ORDER BY total_messages DESC
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">  </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> </span><span class="token dom" style="color: rgb(156, 220, 254);">performance</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">query</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>performanceQuery</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Query 2: Get hourly message trends</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> trendsQuery </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">    SELECT 
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      agentId,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      toStartOfHour(timestamp) as hour,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      COUNT(*) as messages_count,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      AVG(processing_time_ms) as avg_processing_time
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    FROM agent_metrics 
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">    WHERE timestamp &gt;= </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">timeRange</span><span class="token template-string" style="color: rgb(212, 212, 212);">.</span><span class="token template-string property-access" style="color: rgb(156, 220, 254);">start</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);"> AND timestamp &lt;= </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">timeRange</span><span class="token template-string" style="color: rgb(212, 212, 212);">.</span><span class="token template-string property-access" style="color: rgb(156, 220, 254);">end</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">    GROUP BY agentId, hour
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    ORDER BY hour ASC
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">  </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> trends </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">query</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>trendsQuery</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Query 3: Get user satisfaction scores</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> satisfactionQuery </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">    SELECT 
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      agentId,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      AVG(satisfaction_score) as avg_satisfaction,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      COUNT(*) as feedback_count
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    FROM user_satisfaction 
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">    WHERE timestamp &gt;= </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">timeRange</span><span class="token template-string" style="color: rgb(212, 212, 212);">.</span><span class="token template-string property-access" style="color: rgb(156, 220, 254);">start</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);"> AND timestamp &lt;= </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">timeRange</span><span class="token template-string" style="color: rgb(212, 212, 212);">.</span><span class="token template-string property-access" style="color: rgb(156, 220, 254);">end</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">    GROUP BY agentId
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">  </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> satisfaction </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">query</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>satisfactionQuery</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">return</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token dom" style="color: rgb(156, 220, 254);">performance</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token dom" style="color: rgb(156, 220, 254);">performance</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">data</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>    trends</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> trends</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">data</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>    satisfaction</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> satisfaction</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">data</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>    generatedAt</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Date</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">now</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span></span></code></pre></div></div>
<h3 class="text-l font-semibold text-white/90 mt-6 mb-3 font-space-grotesk" id="usage-based-billing-agent-12">Usage-Based Billing Agent</h3>
<p class="text-white/80 mb-4 font-space-grotesk">Track detailed resource usage and implement billing alerts for cost management:</p>
<div class="code-block-container relative group my-6"><div class="flex items-center justify-between bg-[#1e1e1e] border border-white/10 border-b-0 rounded-t-lg px-4 py-2 text-sm"><span class="text-white/60 font-mono text-xs uppercase tracking-wider">typescript</span><button class="flex items-center gap-1.5 px-2 py-1 rounded text-xs transition-all duration-200 hover:bg-white/10 text-white/60 hover:text-white/80 focus:outline-none focus:ring-2 focus:ring-blue-500/50" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy h-3 w-3"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><div class="code-block-content bg-[#1e1e1e] border border-white/10 border-t-0 rounded-b-lg"><pre class="react-syntax-highlighter" style="color: rgb(212, 212, 212); font-size: 0.875rem; text-shadow: none; font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 4; hyphens: none; padding: 1rem; margin: 0px; overflow: visible; background: transparent; border-radius: 0.5rem; max-width: 100%;"><code style="white-space: pre-wrap; font-size: 0.875rem; line-height: 1.5; font-family: var(--font-geist-mono), Monaco, &quot;Cascadia Code&quot;, &quot;Roboto Mono&quot;, Consolas, &quot;Courier New&quot;, monospace; word-break: break-word;"><span><span class="token" style="color: rgb(106, 153, 85);">// Agent that tracks usage for billing purposes</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(197, 134, 192);">export</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">async</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">function</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">processMessage</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>
</span></span><span><span>  sessionId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> messages</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">AIUISDKMessage</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>  platform</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">PlatformServices</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Promise</span><span class="token" style="color: rgb(212, 212, 212);">&lt;</span><span class="token" style="color: rgb(78, 201, 176);">AgentResponse</span><span class="token" style="color: rgb(212, 212, 212);">&gt;</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> memoryStore </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> platform</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Step 1: Get user's current billing plan</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> userPlan </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">getUserBillingPlan</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span> </span><span class="token" style="color: rgb(106, 153, 85);">// "free", "pro", "enterprise"</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> startTime </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Date</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">now</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Step 2: Track API call event</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'billing_events'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      userId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      plan</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> userPlan</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">tier</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      feature</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'message_processing'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      agent_type</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'billing-tracker'</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>    metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      api_calls</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">1</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      base_cost</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> userPlan</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">costPerMessage</span><span> </span><span class="token" style="color: rgb(106, 153, 85);">// $0.01, $0.005, etc.</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Step 3: Process message and measure resource consumption</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> response </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">generateResponse</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">content</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> processingTime </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Date</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">now</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">-</span><span> startTime</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> tokensUsed </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">estimateTokens</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">content</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">+</span><span> response</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Step 4: Calculate detailed costs based on usage</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> costs </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">calculateUsageCosts</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    tokensUsed</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>    processingTime</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>    plan</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> userPlan
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Step 5: Track detailed usage metrics for billing</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'usage_metrics'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      userId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      plan</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> userPlan</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">tier</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      model</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'gpt-4'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(106, 153, 85);">// LLM model used</span><span>
</span></span><span><span>      feature</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'text_generation'</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>    metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      tokens_consumed</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> tokensUsed</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      processing_time_ms</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> processingTime</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      compute_cost</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> costs</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">compute</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>    </span><span class="token" style="color: rgb(106, 153, 85);">// CPU/GPU costs</span><span>
</span></span><span><span>      token_cost</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> costs</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">tokens</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>       </span><span class="token" style="color: rgb(106, 153, 85);">// LLM API costs  </span><span>
</span></span><span><span>      total_cost</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> costs</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">total</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Step 6: Check for billing alerts (80% threshold)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> monthlyUsage </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">getMonthlyUsage</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">if</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>monthlyUsage</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">cost</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">&gt;</span><span> userPlan</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">monthlyLimit</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">*</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">0.8</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'billing_alerts'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        userId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        alert_type</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'usage_warning'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        plan</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> userPlan</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">tier</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        usage_percentage</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>monthlyUsage</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">cost</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">/</span><span> userPlan</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">monthlyLimit</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">*</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">100</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        remaining_budget</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> userPlan</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">monthlyLimit</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">-</span><span> monthlyUsage</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">cost</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>    
</span><span><span>    </span><span class="token" style="color: rgb(106, 153, 85);">// Send notification to user</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">sendBillingAlert</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      type</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'usage_warning'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      currentUsage</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> monthlyUsage</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">cost</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      limit</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> userPlan</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">monthlyLimit</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      percentage</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>monthlyUsage</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">cost</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">/</span><span> userPlan</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">monthlyLimit</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">*</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">100</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">return</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> response </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span></span></code></pre></div></div>
<h3 class="text-l font-semibold text-white/90 mt-6 mb-3 font-space-grotesk" id="a-b-testing-analytics-agent-13">A/B Testing Analytics Agent</h3>
<p class="text-white/80 mb-4 font-space-grotesk">Run experiments and analyze statistical significance of different agent variants:</p>
<div class="code-block-container relative group my-6"><div class="flex items-center justify-between bg-[#1e1e1e] border border-white/10 border-b-0 rounded-t-lg px-4 py-2 text-sm"><span class="text-white/60 font-mono text-xs uppercase tracking-wider">typescript</span><button class="flex items-center gap-1.5 px-2 py-1 rounded text-xs transition-all duration-200 hover:bg-white/10 text-white/60 hover:text-white/80 focus:outline-none focus:ring-2 focus:ring-blue-500/50" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy h-3 w-3"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><div class="code-block-content bg-[#1e1e1e] border border-white/10 border-t-0 rounded-b-lg"><pre class="react-syntax-highlighter" style="color: rgb(212, 212, 212); font-size: 0.875rem; text-shadow: none; font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 4; hyphens: none; padding: 1rem; margin: 0px; overflow: visible; background: transparent; border-radius: 0.5rem; max-width: 100%;"><code style="white-space: pre-wrap; font-size: 0.875rem; line-height: 1.5; font-family: var(--font-geist-mono), Monaco, &quot;Cascadia Code&quot;, &quot;Roboto Mono&quot;, Consolas, &quot;Courier New&quot;, monospace; word-break: break-word;"><span><span class="token" style="color: rgb(106, 153, 85);">// Agent that runs A/B tests and tracks results</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(197, 134, 192);">export</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">async</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">function</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">processMessage</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>
</span></span><span><span>  sessionId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> messages</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">AIUISDKMessage</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>  platform</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">PlatformServices</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Promise</span><span class="token" style="color: rgb(212, 212, 212);">&lt;</span><span class="token" style="color: rgb(78, 201, 176);">AgentResponse</span><span class="token" style="color: rgb(212, 212, 212);">&gt;</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> memoryStore </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> platform</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Step 1: Determine which test variants to use</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> activeTests </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">getActiveTests</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span> </span><span class="token" style="color: rgb(106, 153, 85);">// ["response_style_test", "greeting_test"]</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> userVariants </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">assignTestVariants</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> activeTests</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Example: { "response_style_test": "formal", "greeting_test": "friendly" }</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> startTime </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Date</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">now</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Step 2: Track test exposure events</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">for</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">[</span><span>testId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> variant</span><span class="token" style="color: rgb(212, 212, 212);">]</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">of</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Object</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">entries</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>userVariants</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'ab_test_exposure'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        test_id</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> testId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        variant</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> variant</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(106, 153, 85);">// "control", "variant_a", "variant_b"</span><span>
</span></span><span><span>        userId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        messageType</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">detectMessageType</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">content</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        exposures</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">1</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Step 3: Generate response using assigned test variants</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> response </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">generateResponseWithVariants</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">content</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> userVariants</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> processingTime </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Date</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">now</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">-</span><span> startTime</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Step 4: Track response metrics for each active test</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">for</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">[</span><span>testId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> variant</span><span class="token" style="color: rgb(212, 212, 212);">]</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">of</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Object</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">entries</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>userVariants</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'ab_test_metrics'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        test_id</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> testId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        variant</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> variant</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        userId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        success</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'true'</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        response_time_ms</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> processingTime</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        response_length</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> response</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">length</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        responses</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">1</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">return</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> 
</span></span><span><span>    message</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> response</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>    actions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">[</span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      type</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'ab_test_tracking'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      data</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> userVariants</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> processingTime </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">]</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span></span></code></pre></div></div>
<h3 class="text-l font-semibold text-white/90 mt-6 mb-3 font-space-grotesk" id="real-time-monitoring-agent-14">Real-Time Monitoring Agent</h3>
<p class="text-white/80 mb-4 font-space-grotesk">Monitor system health with automatic anomaly detection and alerting:</p>
<div class="code-block-container relative group my-6"><div class="flex items-center justify-between bg-[#1e1e1e] border border-white/10 border-b-0 rounded-t-lg px-4 py-2 text-sm"><span class="text-white/60 font-mono text-xs uppercase tracking-wider">typescript</span><button class="flex items-center gap-1.5 px-2 py-1 rounded text-xs transition-all duration-200 hover:bg-white/10 text-white/60 hover:text-white/80 focus:outline-none focus:ring-2 focus:ring-blue-500/50" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy h-3 w-3"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><div class="code-block-content bg-[#1e1e1e] border border-white/10 border-t-0 rounded-b-lg"><pre class="react-syntax-highlighter" style="color: rgb(212, 212, 212); font-size: 0.875rem; text-shadow: none; font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 4; hyphens: none; padding: 1rem; margin: 0px; overflow: visible; background: transparent; border-radius: 0.5rem; max-width: 100%;"><code style="white-space: pre-wrap; font-size: 0.875rem; line-height: 1.5; font-family: var(--font-geist-mono), Monaco, &quot;Cascadia Code&quot;, &quot;Roboto Mono&quot;, Consolas, &quot;Courier New&quot;, monospace; word-break: break-word;"><span><span class="token" style="color: rgb(106, 153, 85);">// Agent that monitors system health and alerts</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(197, 134, 192);">export</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">async</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">function</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">processMessage</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>
</span></span><span><span>  sessionId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> messages</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">AIUISDKMessage</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>  platform</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">PlatformServices</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Promise</span><span class="token" style="color: rgb(212, 212, 212);">&lt;</span><span class="token" style="color: rgb(78, 201, 176);">AgentResponse</span><span class="token" style="color: rgb(212, 212, 212);">&gt;</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> analytics </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> platform</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Step 1: Collect current system health metrics</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> healthMetrics </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">collectSystemHealthMetrics</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Returns: { cpu: 45.2, memory: 78.1, connections: 150, queueDepth: 5, errorRate: 0.02 }</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Step 2: Write system metrics to multiple datasets</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoints</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'system_health'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">[</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        service</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'message_processing'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        region</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'global'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        environment</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'production'</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        cpu_usage</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> healthMetrics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">cpu</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        memory_usage</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> healthMetrics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">memory</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        active_connections</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> healthMetrics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">connections</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        queue_depth</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> healthMetrics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">queueDepth</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        error_rate</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> healthMetrics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">errorRate</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        service</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'storage'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        region</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'global'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        environment</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'production'</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        storage_usage</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> healthMetrics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">storageUsage</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        read_latency</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> healthMetrics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">readLatency</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>    </span><span class="token" style="color: rgb(106, 153, 85);">// milliseconds</span><span>
</span></span><span><span>        write_latency</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> healthMetrics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">writeLatency</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// milliseconds</span><span>
</span></span><span><span>        throughput</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> healthMetrics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">throughput</span><span>        </span><span class="token" style="color: rgb(106, 153, 85);">// requests per second</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">]</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Step 3: Run anomaly detection algorithms</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> anomalies </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">detectAnomalies</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>healthMetrics</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Returns: [{ type: 'high_cpu', severity: 'warning', value: 95.2, threshold: 80 }]</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">if</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>anomalies</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">length</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">&gt;</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">0</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(106, 153, 85);">// Step 4: Track alert events</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">for</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> anomaly </span><span class="token" style="color: rgb(86, 156, 214);">of</span><span> anomalies</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'system_alerts'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>          alert_type</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> anomaly</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">type</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>        </span><span class="token" style="color: rgb(106, 153, 85);">// "high_cpu", "memory_leak", "queue_backup"</span><span>
</span></span><span><span>          severity</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> anomaly</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">severity</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>      </span><span class="token" style="color: rgb(106, 153, 85);">// "info", "warning", "critical"</span><span>
</span></span><span><span>          service</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> anomaly</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">service</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>          alert_count</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">1</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>          value</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> anomaly</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">value</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>          threshold</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> anomaly</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">threshold</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>    
</span><span><span>    </span><span class="token" style="color: rgb(106, 153, 85);">// Step 5: Send alerts to operations team</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">sendOperationalAlert</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      anomalies</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      timestamp</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Date</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">now</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      systemMetrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> healthMetrics
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>    
</span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">return</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      message</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token template-string" style="color: rgb(206, 145, 120);">System health check complete. </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">anomalies</span><span class="token template-string" style="color: rgb(212, 212, 212);">.</span><span class="token template-string property-access" style="color: rgb(156, 220, 254);">length</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);"> anomalies detected and alerts sent.</span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      actions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> anomalies</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">map</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>a </span><span class="token" style="color: rgb(86, 156, 214);">=&gt;</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        type</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'anomaly_detected'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        data</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> a
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">return</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    message</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">"System health check complete. All metrics within normal ranges."</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(106, 153, 85);">// Real-time dashboard data aggregation</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(86, 156, 214);">async</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">function</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">getDashboardData</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>platform</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">PlatformServices</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Promise</span><span class="token" style="color: rgb(212, 212, 212);">&lt;</span><span class="token" style="color: rgb(78, 201, 176);">DashboardData</span><span class="token" style="color: rgb(212, 212, 212);">&gt;</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> analytics </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> platform</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> now </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Date</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">now</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> oneHourAgo </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> now </span><span class="token" style="color: rgb(212, 212, 212);">-</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(181, 206, 168);">60</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">*</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">60</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">*</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">1000</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Query 1: Current system status (last 5 minutes)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> currentMetrics </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">query</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">    SELECT 
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      AVG(cpu_usage) as avg_cpu,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      AVG(memory_usage) as avg_memory,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      MAX(queue_depth) as max_queue_depth,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      AVG(error_rate) as avg_error_rate,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      COUNT(*) as metric_count
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    FROM system_health 
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">    WHERE timestamp &gt;= </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">now </span><span class="token template-string" style="color: rgb(212, 212, 212);">-</span><span class="token template-string" style="color: rgb(156, 220, 254);"> </span><span class="token template-string" style="color: rgb(181, 206, 168);">300000</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);"> -- Last 5 minutes
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">      AND service = 'message_processing'
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">  </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Query 2: Hourly trends for charts</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> hourlyTrends </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">query</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">    SELECT 
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      toStartOfMinute(timestamp) as minute,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      AVG(cpu_usage) as cpu,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      AVG(memory_usage) as memory,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      AVG(error_rate) as error_rate
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    FROM system_health 
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">    WHERE timestamp &gt;= </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">oneHourAgo</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">      AND service = 'message_processing'
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    GROUP BY minute
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    ORDER BY minute ASC
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">  </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Query 3: Active alerts summary</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> activeAlerts </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">query</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">    SELECT 
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      alert_type,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      severity,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      COUNT(*) as count,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      MAX(timestamp) as last_occurrence
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    FROM system_alerts 
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">    WHERE timestamp &gt;= </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">oneHourAgo</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">    GROUP BY alert_type, severity
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    ORDER BY count DESC
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">  </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">return</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    current</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> currentMetrics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">data</span><span class="token" style="color: rgb(212, 212, 212);">[</span><span class="token" style="color: rgb(181, 206, 168);">0</span><span class="token" style="color: rgb(212, 212, 212);">]</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>    trends</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> hourlyTrends</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">data</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>    alerts</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> activeAlerts</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">data</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>    lastUpdated</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> now
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span></span></code></pre></div></div>
<h2 id="best-practices" class="text-xl font-bold text-white/90 mt-8 mb-4 font-space-grotesk">Best Practices</h2>
<p class="text-white/80 mb-4 font-space-grotesk">Follow these patterns for optimal analytics performance and maintainability. Use consistent naming conventions and batch operations when possible.</p>
<h3 class="text-l font-semibold text-white/90 mt-6 mb-3 font-space-grotesk" id="efficient-data-modeling-16">Efficient Data Modeling</h3>
<p class="text-white/80 mb-4 font-space-grotesk">Choose appropriate dimension cardinality and use consistent naming conventions to optimize query performance and storage costs.</p>
<div class="code-block-container relative group my-6"><div class="flex items-center justify-between bg-[#1e1e1e] border border-white/10 border-b-0 rounded-t-lg px-4 py-2 text-sm"><span class="text-white/60 font-mono text-xs uppercase tracking-wider">typescript</span><button class="flex items-center gap-1.5 px-2 py-1 rounded text-xs transition-all duration-200 hover:bg-white/10 text-white/60 hover:text-white/80 focus:outline-none focus:ring-2 focus:ring-blue-500/50" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy h-3 w-3"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><div class="code-block-content bg-[#1e1e1e] border border-white/10 border-t-0 rounded-b-lg"><pre class="react-syntax-highlighter" style="color: rgb(212, 212, 212); font-size: 0.875rem; text-shadow: none; font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 4; hyphens: none; padding: 1rem; margin: 0px; overflow: visible; background: transparent; border-radius: 0.5rem; max-width: 100%;"><code style="white-space: pre-wrap; font-size: 0.875rem; line-height: 1.5; font-family: var(--font-geist-mono), Monaco, &quot;Cascadia Code&quot;, &quot;Roboto Mono&quot;, Consolas, &quot;Courier New&quot;, monospace; word-break: break-word;"><span><span class="token" style="color: rgb(106, 153, 85);">// ✅ Good: Use consistent dimension names and optimize for queries</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> standardDimensions </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  userId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>  agentId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'my-agent'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>  environment</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'production'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>  version</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'1.0.0'</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(106, 153, 85);">// ✅ Good: Batch data points for better performance</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> dataPoints </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> messages</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">map</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>msg </span><span class="token" style="color: rgb(86, 156, 214);">=&gt;</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token spread" style="color: rgb(212, 212, 212);">...</span><span>standardDimensions</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>    messageType</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">detectType</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>msg</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">content</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>  metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    processing_time</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> msg</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">processingTime</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>    tokens_used</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> msg</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">tokensUsed</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoints</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'agent_metrics'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> dataPoints</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(106, 153, 85);">// ❌ Bad: Inconsistent dimension names</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'metrics'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    user_id</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'user1'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>        </span><span class="token" style="color: rgb(106, 153, 85);">// Inconsistent naming</span><span>
</span></span><span><span>    agent</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'my-agent'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>       </span><span class="token" style="color: rgb(106, 153, 85);">// Missing 'Id' suffix</span><span>
</span></span><span><span>    env</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'prod'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>            </span><span class="token" style="color: rgb(106, 153, 85);">// Abbreviation instead of full name</span><span>
</span></span><span><span>    ver</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'1.0'</span><span>              </span><span class="token" style="color: rgb(106, 153, 85);">// Different naming pattern</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(106, 153, 85);">// ❌ Bad: High cardinality dimensions (too many unique values)</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'metrics'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    userId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>    timestamp</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Date</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">now</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">toString</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Unique for every event</span><span>
</span></span><span><span>    messageContent</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">content</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>   </span><span class="token" style="color: rgb(106, 153, 85);">// Potentially unlimited values</span><span>
</span></span><span><span>    sessionId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">generateUUID</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span>          </span><span class="token" style="color: rgb(106, 153, 85);">// High cardinality</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(106, 153, 85);">// ❌ Bad: Individual writes instead of batching</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(197, 134, 192);">for</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> msg </span><span class="token" style="color: rgb(86, 156, 214);">of</span><span> messages</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'metrics'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> </span><span class="token" style="color: rgb(106, 153, 85);">/* data */</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span> </span><span class="token" style="color: rgb(106, 153, 85);">// Multiple network calls</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span></span></code></pre></div></div>
<h3 class="text-l font-semibold text-white/90 mt-6 mb-3 font-space-grotesk" id="query-optimization-17">Query Optimization</h3>
<p class="text-white/80 mb-4 font-space-grotesk">Write efficient SQL queries that filter early and use appropriate aggregations to minimize data transfer and processing time.</p>
<div class="code-block-container relative group my-6"><div class="flex items-center justify-between bg-[#1e1e1e] border border-white/10 border-b-0 rounded-t-lg px-4 py-2 text-sm"><span class="text-white/60 font-mono text-xs uppercase tracking-wider">typescript</span><button class="flex items-center gap-1.5 px-2 py-1 rounded text-xs transition-all duration-200 hover:bg-white/10 text-white/60 hover:text-white/80 focus:outline-none focus:ring-2 focus:ring-blue-500/50" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy h-3 w-3"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><div class="code-block-content bg-[#1e1e1e] border border-white/10 border-t-0 rounded-b-lg"><pre class="react-syntax-highlighter" style="color: rgb(212, 212, 212); font-size: 0.875rem; text-shadow: none; font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 4; hyphens: none; padding: 1rem; margin: 0px; overflow: visible; background: transparent; border-radius: 0.5rem; max-width: 100%;"><code style="white-space: pre-wrap; font-size: 0.875rem; line-height: 1.5; font-family: var(--font-geist-mono), Monaco, &quot;Cascadia Code&quot;, &quot;Roboto Mono&quot;, Consolas, &quot;Courier New&quot;, monospace; word-break: break-word;"><span><span class="token" style="color: rgb(106, 153, 85);">// ✅ Good: Use time range filters and appropriate aggregations</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> optimizedQuery </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">  SELECT 
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    agentId,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    toStartOfHour(timestamp) as hour,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    COUNT(*) as message_count,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    AVG(processing_time) as avg_processing_time
</span><span class="token template-string" style="color: rgb(206, 145, 120);">  FROM agent_metrics 
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">  WHERE timestamp &gt;= </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">startTime</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);"> 
</span></span><span><span class="token template-string" style="color: rgb(206, 145, 120);">    AND timestamp &lt;= </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">endTime</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">    AND agentId IN ('agent1', 'agent2') -- Filter early
</span><span class="token template-string" style="color: rgb(206, 145, 120);">  GROUP BY agentId, hour
</span><span class="token template-string" style="color: rgb(206, 145, 120);">  ORDER BY hour ASC
</span><span class="token template-string" style="color: rgb(206, 145, 120);">  LIMIT 1000
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);"></span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(106, 153, 85);">// ✅ Good: Use CTEs for complex queries</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> complexQuery </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">  WITH recent_data AS (
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    SELECT agentId, processing_time 
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    FROM agent_metrics 
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">    WHERE timestamp &gt;= </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">oneHourAgo</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">  ),
</span><span class="token template-string" style="color: rgb(206, 145, 120);">  aggregated AS (
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    SELECT 
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      agentId,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      AVG(processing_time) as avg_time,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      COUNT(*) as total_count
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    FROM recent_data
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    GROUP BY agentId
</span><span class="token template-string" style="color: rgb(206, 145, 120);">  )
</span><span class="token template-string" style="color: rgb(206, 145, 120);">  SELECT * FROM aggregated 
</span><span class="token template-string" style="color: rgb(206, 145, 120);">  WHERE total_count &gt; 10
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);"></span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(106, 153, 85);">// ❌ Bad: No time range filters</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> badQuery </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">  SELECT * FROM agent_metrics  -- Scans entire dataset
</span><span class="token template-string" style="color: rgb(206, 145, 120);">  WHERE agentId = 'my-agent'
</span><span class="token template-string" style="color: rgb(206, 145, 120);">  ORDER BY timestamp DESC
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);"></span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(106, 153, 85);">// ❌ Bad: Inefficient aggregations</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> inefficientQuery </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">  SELECT 
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    userId,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    agentId,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    timestamp,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    processing_time
</span><span class="token template-string" style="color: rgb(206, 145, 120);">  FROM agent_metrics 
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">  WHERE timestamp &gt;= </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">startTime</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">  -- No aggregation, returns raw data
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);"></span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(106, 153, 85);">// ❌ Bad: Missing LIMIT causes large result sets</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> unlimitedQuery </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">  SELECT * FROM agent_metrics 
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">  WHERE timestamp &gt;= </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">startTime</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">  -- No LIMIT, could return millions of rows
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);"></span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token" style="color: rgb(212, 212, 212);">;</span></span></code></pre></div></div>
<h3 class="text-l font-semibold text-white/90 mt-6 mb-3 font-space-grotesk" id="error-handling-18">Error Handling</h3>
<p class="text-white/80 mb-4 font-space-grotesk">Implement graceful error handling to ensure analytics failures don't break your main application flow.</p>
<div class="code-block-container relative group my-6"><div class="flex items-center justify-between bg-[#1e1e1e] border border-white/10 border-b-0 rounded-t-lg px-4 py-2 text-sm"><span class="text-white/60 font-mono text-xs uppercase tracking-wider">typescript</span><button class="flex items-center gap-1.5 px-2 py-1 rounded text-xs transition-all duration-200 hover:bg-white/10 text-white/60 hover:text-white/80 focus:outline-none focus:ring-2 focus:ring-blue-500/50" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy h-3 w-3"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><div class="code-block-content bg-[#1e1e1e] border border-white/10 border-t-0 rounded-b-lg"><pre class="react-syntax-highlighter" style="color: rgb(212, 212, 212); font-size: 0.875rem; text-shadow: none; font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 4; hyphens: none; padding: 1rem; margin: 0px; overflow: visible; background: transparent; border-radius: 0.5rem; max-width: 100%;"><code style="white-space: pre-wrap; font-size: 0.875rem; line-height: 1.5; font-family: var(--font-geist-mono), Monaco, &quot;Cascadia Code&quot;, &quot;Roboto Mono&quot;, Consolas, &quot;Courier New&quot;, monospace; word-break: break-word;"><span><span class="token" style="color: rgb(106, 153, 85);">// ✅ Good: Handle analytics failures gracefully</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(86, 156, 214);">async</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">function</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">safeWriteMetrics</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>analytics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">Analytics</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> dataset</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> data</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">AnalyticsDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">try</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>dataset</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> data</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">catch</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>error</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(78, 201, 176);">console</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">error</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'Analytics write failed:'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> error</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(106, 153, 85);">// Don't fail the main operation</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(106, 153, 85);">// ✅ Good: Retry logic for transient failures</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(86, 156, 214);">async</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">function</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">writeMetricsWithRetry</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>analytics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">Analytics</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> dataset</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> data</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">AnalyticsDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> maxRetries </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">3</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">let</span><span> attempt </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">0</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">while</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>attempt </span><span class="token" style="color: rgb(212, 212, 212);">&lt;</span><span> maxRetries</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">try</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>dataset</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> data</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(197, 134, 192);">return</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span> </span><span class="token" style="color: rgb(106, 153, 85);">// Success</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">catch</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>error</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      attempt</span><span class="token" style="color: rgb(212, 212, 212);">++</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(197, 134, 192);">if</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>attempt </span><span class="token" style="color: rgb(212, 212, 212);">&gt;=</span><span> maxRetries</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(78, 201, 176);">console</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">error</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token template-string" style="color: rgb(206, 145, 120);">Analytics write failed after </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">maxRetries</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);"> attempts:</span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> error</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(197, 134, 192);">return</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span> </span><span class="token" style="color: rgb(106, 153, 85);">// Give up gracefully</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>      
</span><span><span>      </span><span class="token" style="color: rgb(106, 153, 85);">// Exponential backoff</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">new</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Promise</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>resolve </span><span class="token" style="color: rgb(86, 156, 214);">=&gt;</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">setTimeout</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>resolve</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Math</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">pow</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(181, 206, 168);">2</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> attempt</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">*</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">1000</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(106, 153, 85);">// ✅ Good: Validate data before writing</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(86, 156, 214);">async</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">function</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">validateAndWrite</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>analytics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">Analytics</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> dataset</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> data</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">AnalyticsDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Check required fields</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">if</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">!</span><span>data</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">dimensions</span><span class="token" style="color: rgb(212, 212, 212);">?.</span><span>agentId</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(78, 201, 176);">console</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">warn</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'Missing required agentId dimension'</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">return</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Validate dimension cardinality</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">if</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Object</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">keys</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>data</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">dimensions</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">length</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">&gt;</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">20</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(78, 201, 176);">console</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">warn</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'Too many dimensions, truncating'</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>    data</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">dimensions</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Object</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">fromEntries</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>
</span></span><span><span>      </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Object</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">entries</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>data</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">dimensions</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">slice</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(181, 206, 168);">0</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">20</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">safeWriteMetrics</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>analytics</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> dataset</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> data</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(106, 153, 85);">// ❌ Bad: Let analytics failures break main functionality</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(86, 156, 214);">async</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">function</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">processMessage</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>sessionId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> messages</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">AIUISDKMessage</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Main business logic</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> response </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">generateResponse</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">content</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// This could break the entire function</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'metrics'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> userId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">return</span><span> response</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(106, 153, 85);">// ❌ Bad: No error handling or validation</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'metrics'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token null nil" style="color: rgb(86, 156, 214);">null</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Could cause errors</span><span>
</span></span><span><span>  metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token nil" style="color: rgb(86, 156, 214);">undefined</span><span> </span><span class="token" style="color: rgb(106, 153, 85);">// Invalid data</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span></span></code></pre></div></div>
<h2 id="limitations--considerations" class="text-xl font-bold text-white/90 mt-8 mb-4 font-space-grotesk">Limitations &amp; Considerations</h2>
<ul class="list-disc pl-6 space-y-2 mb-4 text-white/80 font-space-grotesk">
<li class="text-white/80 font-space-grotesk"><strong>Data Point Size</strong>: Maximum 25 fields per data point</li>
<li class="text-white/80 font-space-grotesk"><strong>String Length</strong>: Maximum 256 characters per string field</li>
<li class="text-white/80 font-space-grotesk"><strong>Write Rate</strong>: Up to 25,000 data points per minute per dataset</li>
<li class="text-white/80 font-space-grotesk"><strong>Retention</strong>: Data retained for 3 months by default</li>
<li class="text-white/80 font-space-grotesk"><strong>Query Complexity</strong>: Limited to 1000 result rows per query</li>
</ul>
<h2 id="related-services" class="text-xl font-bold text-white/90 mt-8 mb-4 font-space-grotesk">Related Services</h2>
<ul class="list-disc pl-6 space-y-2 mb-4 text-white/80 font-space-grotesk">
<li class="text-white/80 font-space-grotesk"><strong><a class="text-[#7E98FF] hover:text-[#7E98FF] hover:underline font-space-grotesk" href="https://nullshot.ai/en/developers/platform/memory-store">Memory Store (KV)</a></strong> - Store analytics configurations and cache query results</li>
<li class="text-white/80 font-space-grotesk"><strong><a class="text-[#7E98FF] hover:text-[#7E98FF] hover:underline font-space-grotesk" href="https://nullshot.ai/en/developers/platform/queues">Queues</a></strong> - Buffer high-volume analytics data</li>
<li class="text-white/80 font-space-grotesk"><strong><a class="text-[#7E98FF] hover:text-[#7E98FF] hover:underline font-space-grotesk" href="https://nullshot.ai/en/developers/platform/logs">Logs</a></strong> - Detailed debugging information to complement metrics</li>
</ul></div></div><div class="mt-12 flex flex-col md:flex-row gap-4"><a class="md:flex-1 rounded-lg border border-white/20 p-4 md:p-6 text-white/80 hover:text-white transition-colors group hover:border-white/40" href="https://nullshot.ai/en/docs/developers/platform/overview"><div class="flex items-center justify-between"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-left h-5 w-5 text-blue-400 group-hover:text-blue-300 transition-colors flex-shrink-0"><path d="m15 18-6-6 6-6"></path></svg><div class="min-w-0 text-right"><div class="text-sm text-white/60 font-space-grotesk mb-1">Previous</div><div class="text-base font-medium font-space-grotesk truncate">Overview</div></div></div></a><a class="md:flex-1 rounded-lg border border-white/20 p-4 md:p-6 text-white/80 hover:text-white transition-colors group hover:border-white/40" href="https://nullshot.ai/en/docs/developers/platform/cache"><div class="flex items-center justify-between"><div class="min-w-0 text-left"><div class="text-sm text-white/60 font-space-grotesk mb-1">Next</div><div class="text-base font-medium font-space-grotesk truncate">Cache</div></div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-5 w-5 text-blue-400 group-hover:text-blue-300 transition-colors flex-shrink-0"><path d="m9 18 6-6-6-6"></path></svg></div></a></div></div></div></div></div></div><div class="w-64 border-l border-white/10 bg-[#16171A] flex-shrink-0"><div class="sticky top-0 h-screen overflow-y-auto scrollbar-hide"><div class="w-full h-full pt-6 px-4 overflow-y-auto scrollbar-hide"><div class="pt-4"><h4 class="font-medium text-sm text-white/60 mb-4 font-space-grotesk">On This Page</h4><div class="flex flex-row"><div class="w-[2px] bg-white/20 relative overflow-hidden"><div class="absolute w-full h-6 bg-gradient-to-b from-[#997EDE] to-[#77A7FF] transition-transform duration-200" style="transform: translateY(686px);"></div></div><nav class="flex-1 pl-3"><div class="space-y-2"><a href="https://nullshot.ai/en/docs/developers/platform/analytics-engine#key-features" class="block py-1 text-sm rounded-md transition-colors font-space-grotesk text-white/60 hover:text-white">Key Features</a><a href="https://nullshot.ai/en/docs/developers/platform/analytics-engine#getting-started" class="block py-1 text-sm rounded-md transition-colors font-space-grotesk text-white/60 hover:text-white">Getting Started</a><a href="https://nullshot.ai/en/docs/developers/platform/analytics-engine#wrangler-configuration-2" class="block py-1 text-sm rounded-md transition-colors font-space-grotesk text-white/60 hover:text-white">Wrangler Configuration</a><a href="https://nullshot.ai/en/docs/developers/platform/analytics-engine#agent-integration-3" class="block py-1 text-sm rounded-md transition-colors font-space-grotesk text-white/60 hover:text-white">Agent Integration</a><a href="https://nullshot.ai/en/docs/developers/platform/analytics-engine#basic-query-example-4" class="block py-1 text-sm rounded-md transition-colors font-space-grotesk text-white/60 hover:text-white">Basic Query Example</a><a href="https://nullshot.ai/en/docs/developers/platform/analytics-engine#mcp-integration-5" class="block py-1 text-sm rounded-md transition-colors font-space-grotesk text-white/60 hover:text-white">MCP Integration</a><a href="https://nullshot.ai/en/docs/developers/platform/analytics-engine#typescript-api-reference" class="block py-1 text-sm rounded-md transition-colors font-space-grotesk text-white/60 hover:text-white">TypeScript API Reference</a><a href="https://nullshot.ai/en/docs/developers/platform/analytics-engine#data-writing-methods-7" class="block py-1 text-sm rounded-md transition-colors font-space-grotesk text-white/60 hover:text-white">Data Writing Methods</a><a href="https://nullshot.ai/en/docs/developers/platform/analytics-engine#query-methods-8" class="block py-1 text-sm rounded-md transition-colors font-space-grotesk text-white/60 hover:text-white">Query Methods</a><a href="https://nullshot.ai/en/docs/developers/platform/analytics-engine#data-structures-9" class="block py-1 text-sm rounded-md transition-colors font-space-grotesk text-white/60 hover:text-white">Data Structures</a><a href="https://nullshot.ai/en/docs/developers/platform/analytics-engine#examples" class="block py-1 text-sm rounded-md transition-colors font-space-grotesk text-white/60 hover:text-white">Examples</a><a href="https://nullshot.ai/en/docs/developers/platform/analytics-engine#performance-monitoring-agent-11" class="block py-1 text-sm rounded-md transition-colors font-space-grotesk text-white/60 hover:text-white">Performance Monitoring Agent</a><a href="https://nullshot.ai/en/docs/developers/platform/analytics-engine#usage-based-billing-agent-12" class="block py-1 text-sm rounded-md transition-colors font-space-grotesk text-white/60 hover:text-white">Usage-Based Billing Agent</a><a href="https://nullshot.ai/en/docs/developers/platform/analytics-engine#a-b-testing-analytics-agent-13" class="block py-1 text-sm rounded-md transition-colors font-space-grotesk text-white/60 hover:text-white">A/B Testing Analytics Agent</a><a href="https://nullshot.ai/en/docs/developers/platform/analytics-engine#real-time-monitoring-agent-14" class="block py-1 text-sm rounded-md transition-colors font-space-grotesk text-white/60 hover:text-white">Real-Time Monitoring Agent</a><a href="https://nullshot.ai/en/docs/developers/platform/analytics-engine#best-practices" class="block py-1 text-sm rounded-md transition-colors font-space-grotesk text-white/60 hover:text-white">Best Practices</a><a href="https://nullshot.ai/en/docs/developers/platform/analytics-engine#efficient-data-modeling-16" class="block py-1 text-sm rounded-md transition-colors font-space-grotesk text-white/60 hover:text-white">Efficient Data Modeling</a><a href="https://nullshot.ai/en/docs/developers/platform/analytics-engine#query-optimization-17" class="block py-1 text-sm rounded-md transition-colors font-space-grotesk text-white/60 hover:text-white">Query Optimization</a><a href="https://nullshot.ai/en/docs/developers/platform/analytics-engine#error-handling-18" class="block py-1 text-sm rounded-md transition-colors font-space-grotesk text-white/60 hover:text-white">Error Handling</a><a href="https://nullshot.ai/en/docs/developers/platform/analytics-engine#limitations--considerations" class="block py-1 text-sm rounded-md transition-colors font-space-grotesk font-medium bg-gradient-to-r from-[#997EDE] to-[#77A7FF] bg-clip-text text-transparent">Limitations &amp; Considerations</a><a href="https://nullshot.ai/en/docs/developers/platform/analytics-engine#related-services" class="block py-1 text-sm rounded-md transition-colors font-space-grotesk text-white/60 hover:text-white">Related Services</a></div></nav></div></div></div></div></div></div><div class="md:hidden bg-[#14161D] min-h-screen pt-16"><div id="docs-main-content-mobile" class="overflow-y-auto"><div class="md:hidden px-5 py-8 bg-[#16171A]"><button class="w-full flex items-center justify-between gap-2 px-4 py-3 bg-[#323546] text-white rounded-xl transition-colors min-h-[48px] touch-manipulation" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-_R_d9fknmjb_" data-state="closed"><span class="text-sm font-bold font-space-grotesk">Platform</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down h-4 w-4 text-white/80"><path d="m6 9 6 6 6-6"></path></svg></button></div><!--$--><!--/$--><div class="md:py-12"><div class="max-w-4xl mx-auto px-4 md:px-6"><div class="md:border md:border-white/20 md:rounded-xl p-4 md:p-8 bg-[#16171A]"><div class="mb-8"><h1 class="text-4xl font-bold leading-tight text-white mb-3 font-space-grotesk">Analytics Engine</h1></div><div class="prose prose-invert prose-headings:text-white/90 prose-p:text-white/80 prose-a:text-blue-400 max-w-none prose-pre:p-0 prose-pre:bg-transparent prose-code:bg-transparent prose-code:p-0"><div class="mdx-content"><p class="text-white/80 mb-4 font-space-grotesk"><strong>Turn your agent data into actionable insights.</strong> Analytics Engine is a time-series database optimized for storing and querying metrics at massive scale. Perfect for tracking agent performance, user engagement, billing data, trading data, and generating real-time dashboards.</p>
<h2 id="key-features" class="text-xl font-bold text-white/90 mt-8 mb-4 font-space-grotesk">Key Features</h2>
<ul class="list-disc pl-6 space-y-2 mb-4 text-white/80 font-space-grotesk">
<li class="text-white/80 font-space-grotesk"><strong>Time-Series Optimized</strong>: Built for high-frequency metric ingestion with 90 day retention</li>
<li class="text-white/80 font-space-grotesk"><strong>SQL Querying</strong>: Use familiar SQL to analyze your data</li>
<li class="text-white/80 font-space-grotesk"><strong>Real-Time Analytics</strong>: Query data as soon as it's written</li>
<li class="text-white/80 font-space-grotesk"><strong>Cost Effective</strong>: Pay only for data points written, not storage</li>
<li class="text-white/80 font-space-grotesk"><strong>Global Distribution</strong>: Data available worldwide with low latency</li>
</ul>
<p class="text-white/80 mb-4 font-space-grotesk"><em>NOTE: If you are looking for longer storage retention, consider <a class="text-[#7E98FF] hover:text-[#7E98FF] hover:underline font-space-grotesk" href="https://nullshot.ai/en/developers/platform/d1-database">SQL Database</a> combined with caching techniques to achieve similar results.</em></p>
<h2 id="getting-started" class="text-xl font-bold text-white/90 mt-8 mb-4 font-space-grotesk">Getting Started</h2>
<h3 class="text-l font-semibold text-white/90 mt-6 mb-3 font-space-grotesk" id="wrangler-configuration">Wrangler Configuration</h3>
<p class="text-white/80 mb-4 font-space-grotesk">First, add analytics in your <code class="bg-black/50 px-1 py-0.5 rounded text-green-400 font-mono text-sm">wrangler.json</code>:</p>
<div class="code-block-container relative group my-6"><div class="flex items-center justify-between bg-[#1e1e1e] border border-white/10 border-b-0 rounded-t-lg px-4 py-2 text-sm"><span class="text-white/60 font-mono text-xs uppercase tracking-wider">json</span><button class="flex items-center gap-1.5 px-2 py-1 rounded text-xs transition-all duration-200 hover:bg-white/10 text-white/60 hover:text-white/80 focus:outline-none focus:ring-2 focus:ring-blue-500/50" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy h-3 w-3"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><div class="code-block-content bg-[#1e1e1e] border border-white/10 border-t-0 rounded-b-lg"><pre class="react-syntax-highlighter" style="color: rgb(212, 212, 212); font-size: 0.875rem; text-shadow: none; font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 4; hyphens: none; padding: 1rem; margin: 0px; overflow: visible; background: transparent; border-radius: 0.5rem; max-width: 100%;"><code style="white-space: pre-wrap; font-size: 0.875rem; line-height: 1.5; font-family: var(--font-geist-mono), Monaco, &quot;Cascadia Code&quot;, &quot;Roboto Mono&quot;, Consolas, &quot;Courier New&quot;, monospace; word-break: break-word;"><span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(156, 220, 254);">"analytics_engine_datasets"</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">[</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(156, 220, 254);">"binding"</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">"ANALYTICS"</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(156, 220, 254);">"dataset"</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">"agent_metrics"</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">]</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span></span></code></pre></div></div>
<h3 class="text-l font-semibold text-white/90 mt-6 mb-3 font-space-grotesk" id="agent-integration">Agent Integration</h3>
<p class="text-white/80 mb-4 font-space-grotesk">Access analytics through your agent's environment and start tracking basic metrics:</p>
<div class="code-block-container relative group my-6"><div class="flex items-center justify-between bg-[#1e1e1e] border border-white/10 border-b-0 rounded-t-lg px-4 py-2 text-sm"><span class="text-white/60 font-mono text-xs uppercase tracking-wider">typescript</span><button class="flex items-center gap-1.5 px-2 py-1 rounded text-xs transition-all duration-200 hover:bg-white/10 text-white/60 hover:text-white/80 focus:outline-none focus:ring-2 focus:ring-blue-500/50" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy h-3 w-3"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><div class="code-block-content bg-[#1e1e1e] border border-white/10 border-t-0 rounded-b-lg"><pre class="react-syntax-highlighter" style="color: rgb(212, 212, 212); font-size: 0.875rem; text-shadow: none; font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 4; hyphens: none; padding: 1rem; margin: 0px; overflow: visible; background: transparent; border-radius: 0.5rem; max-width: 100%;"><code style="white-space: pre-wrap; font-size: 0.875rem; line-height: 1.5; font-family: var(--font-geist-mono), Monaco, &quot;Cascadia Code&quot;, &quot;Roboto Mono&quot;, Consolas, &quot;Courier New&quot;, monospace; word-break: break-word;"><span><span class="token" style="color: rgb(106, 153, 85);">// src/agents/AnalyticsAgent.ts</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(197, 134, 192);">import</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span class="token"> </span><span class="token" style="color: rgb(156, 220, 254);">AiAgentSDK</span><span class="token"> </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">from</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'@typescript-agent-framework/core'</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(197, 134, 192);">export</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">class</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">AnalyticsAgent</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">extends</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">AiAgentSDK</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(220, 220, 170);">constructor</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>env</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">Env</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(86, 156, 214);">super</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>env</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">async</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">processMessage</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>sessionId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> messages</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">AIUISDKMessage</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Promise</span><span class="token" style="color: rgb(212, 212, 212);">&lt;</span><span class="token" style="color: rgb(78, 201, 176);">AgentResponse</span><span class="token" style="color: rgb(212, 212, 212);">&gt;</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> </span><span class="token" style="color: rgb(156, 220, 254);">ANALYTICS</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">this</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">env</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> startTime </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Date</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">now</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>    
</span><span><span>    </span><span class="token" style="color: rgb(106, 153, 85);">// Track message received</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(156, 220, 254);">ANALYTICS</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'agent_metrics'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        agentId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'analytics-demo'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        userId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        messageType</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'user_message'</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        messages_received</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">1</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        message_length</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">content</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">length</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>    
</span><span><span>    </span><span class="token" style="color: rgb(106, 153, 85);">// Process the message</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> response </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">this</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">generateResponse</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">content</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> processingTime </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Date</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">now</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">-</span><span> startTime</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>    
</span><span><span>    </span><span class="token" style="color: rgb(106, 153, 85);">// Track processing metrics</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(156, 220, 254);">ANALYTICS</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'agent_metrics'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        agentId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'analytics-demo'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        userId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        success</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'true'</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        processing_time_ms</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> processingTime</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        responses_generated</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">1</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>    
</span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">return</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> response </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span></span></code></pre></div></div>
<h3 class="text-l font-semibold text-white/90 mt-6 mb-3 font-space-grotesk" id="basic-query-example">Basic Query Example</h3>
<p class="text-white/80 mb-4 font-space-grotesk">Query your analytics data using SQL to extract meaningful insights:</p>
<div class="code-block-container relative group my-6"><div class="flex items-center justify-between bg-[#1e1e1e] border border-white/10 border-b-0 rounded-t-lg px-4 py-2 text-sm"><span class="text-white/60 font-mono text-xs uppercase tracking-wider">typescript</span><button class="flex items-center gap-1.5 px-2 py-1 rounded text-xs transition-all duration-200 hover:bg-white/10 text-white/60 hover:text-white/80 focus:outline-none focus:ring-2 focus:ring-blue-500/50" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy h-3 w-3"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><div class="code-block-content bg-[#1e1e1e] border border-white/10 border-t-0 rounded-b-lg"><pre class="react-syntax-highlighter" style="color: rgb(212, 212, 212); font-size: 0.875rem; text-shadow: none; font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 4; hyphens: none; padding: 1rem; margin: 0px; overflow: visible; background: transparent; border-radius: 0.5rem; max-width: 100%;"><code style="white-space: pre-wrap; font-size: 0.875rem; line-height: 1.5; font-family: var(--font-geist-mono), Monaco, &quot;Cascadia Code&quot;, &quot;Roboto Mono&quot;, Consolas, &quot;Courier New&quot;, monospace; word-break: break-word;"><span><span class="token" style="color: rgb(106, 153, 85);">// Query recent performance metrics</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(86, 156, 214);">async</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">function</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">getRecentMetrics</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>analytics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">Analytics</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Promise</span><span class="token" style="color: rgb(212, 212, 212);">&lt;</span><span class="token" style="color: rgb(206, 145, 120);">any</span><span class="token" style="color: rgb(212, 212, 212);">[</span><span class="token" style="color: rgb(212, 212, 212);">]</span><span class="token" style="color: rgb(212, 212, 212);">&gt;</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> oneHourAgo </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Date</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">now</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">-</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(181, 206, 168);">60</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">*</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">60</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">*</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">1000</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> query </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">    SELECT 
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      agentId,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      COUNT(*) as total_messages,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      AVG(processing_time_ms) as avg_processing_time
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    FROM agent_metrics 
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">    WHERE timestamp &gt;= </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">oneHourAgo</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">      AND success = 'true'
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    GROUP BY agentId
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    ORDER BY total_messages DESC
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">  </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> result </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">query</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>query</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">return</span><span> result</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">data</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span></span></code></pre></div></div>
<h3 class="text-l font-semibold text-white/90 mt-6 mb-3 font-space-grotesk" id="mcp-integration">MCP Integration</h3>
<div class="code-block-container relative group my-6"><div class="flex items-center justify-between bg-[#1e1e1e] border border-white/10 border-b-0 rounded-t-lg px-4 py-2 text-sm"><span class="text-white/60 font-mono text-xs uppercase tracking-wider">typescript</span><button class="flex items-center gap-1.5 px-2 py-1 rounded text-xs transition-all duration-200 hover:bg-white/10 text-white/60 hover:text-white/80 focus:outline-none focus:ring-2 focus:ring-blue-500/50" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy h-3 w-3"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><div class="code-block-content bg-[#1e1e1e] border border-white/10 border-t-0 rounded-b-lg"><pre class="react-syntax-highlighter" style="color: rgb(212, 212, 212); font-size: 0.875rem; text-shadow: none; font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 4; hyphens: none; padding: 1rem; margin: 0px; overflow: visible; background: transparent; border-radius: 0.5rem; max-width: 100%;"><code style="white-space: pre-wrap; font-size: 0.875rem; line-height: 1.5; font-family: var(--font-geist-mono), Monaco, &quot;Cascadia Code&quot;, &quot;Roboto Mono&quot;, Consolas, &quot;Courier New&quot;, monospace; word-break: break-word;"><span><span class="token" style="color: rgb(106, 153, 85);">// src/mcp/AnalyticsMCPServer.ts</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(197, 134, 192);">import</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span class="token"> </span><span class="token" style="color: rgb(156, 220, 254);">MCPServerDO</span><span class="token"> </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">from</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'@typescript-agent-framework/mcp'</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(197, 134, 192);">export</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">class</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">AnalyticsMCPServer</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">extends</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">MCPServerDO</span><span class="token" style="color: rgb(212, 212, 212);">&lt;</span><span class="token" style="color: rgb(78, 201, 176);">Env</span><span class="token" style="color: rgb(212, 212, 212);">&gt;</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(220, 220, 170);">constructor</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>state</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">DurableObjectState</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> env</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">Env</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(86, 156, 214);">super</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>state</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> env</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>
</span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">protected</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">configureServer</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">return</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      </span><span class="token string-property" style="color: rgb(156, 220, 254);">'track-event'</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">async</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> event</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> dimensions</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> metrics </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> 
</span></span><span><span>        event</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span> 
</span></span><span><span>        dimensions</span><span class="token" style="color: rgb(212, 212, 212);">?</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">Record</span><span class="token" style="color: rgb(212, 212, 212);">&lt;</span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">&gt;</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span> 
</span></span><span><span>        metrics</span><span class="token" style="color: rgb(212, 212, 212);">?</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">Record</span><span class="token" style="color: rgb(212, 212, 212);">&lt;</span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">number</span><span class="token" style="color: rgb(212, 212, 212);">&gt;</span><span> 
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">=&gt;</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> </span><span class="token" style="color: rgb(156, 220, 254);">ANALYTICS</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">this</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">env</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>        
</span><span><span>        </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(156, 220, 254);">ANALYTICS</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'mcp_events'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>          dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>            event_type</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> event</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>            source</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'mcp-server'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>            </span><span class="token spread" style="color: rgb(212, 212, 212);">...</span><span>dimensions
</span></span><span><span>          </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>          metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>            event_count</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">1</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>            </span><span class="token spread" style="color: rgb(212, 212, 212);">...</span><span>metrics
</span></span><span><span>          </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>        
</span><span><span>        </span><span class="token" style="color: rgb(197, 134, 192);">return</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>          success</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">true</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>          message</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token template-string" style="color: rgb(206, 145, 120);">Tracked event: </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">event</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>          timestamp</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Date</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">now</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span>      
</span><span><span>      </span><span class="token string-property" style="color: rgb(156, 220, 254);">'query-metrics'</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">async</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> sql </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> sql</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">=&gt;</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> </span><span class="token" style="color: rgb(156, 220, 254);">ANALYTICS</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">this</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">env</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>        
</span><span><span>        </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> result </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(156, 220, 254);">ANALYTICS</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">query</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>sql</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(197, 134, 192);">return</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>          success</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">true</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>          data</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> result</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">data</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>          rowCount</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> result</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">data</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">length</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span></span></code></pre></div></div>
<h2 id="typescript-api-reference" class="text-xl font-bold text-white/90 mt-8 mb-4 font-space-grotesk">TypeScript API Reference</h2>
<p class="text-white/80 mb-4 font-space-grotesk">You can access the analytics API via the <code class="bg-black/50 px-1 py-0.5 rounded text-green-400 font-mono text-sm">env</code> of the <strong>Agent</strong> or <strong>MCP Tool</strong>:</p>
<div class="code-block-container relative group my-6"><div class="flex items-center justify-between bg-[#1e1e1e] border border-white/10 border-b-0 rounded-t-lg px-4 py-2 text-sm"><span class="text-white/60 font-mono text-xs uppercase tracking-wider">typescript</span><button class="flex items-center gap-1.5 px-2 py-1 rounded text-xs transition-all duration-200 hover:bg-white/10 text-white/60 hover:text-white/80 focus:outline-none focus:ring-2 focus:ring-blue-500/50" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy h-3 w-3"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><div class="code-block-content bg-[#1e1e1e] border border-white/10 border-t-0 rounded-b-lg"><pre class="react-syntax-highlighter" style="color: rgb(212, 212, 212); font-size: 0.875rem; text-shadow: none; font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 4; hyphens: none; padding: 1rem; margin: 0px; overflow: visible; background: transparent; border-radius: 0.5rem; max-width: 100%;"><code style="white-space: pre-wrap; font-size: 0.875rem; line-height: 1.5; font-family: var(--font-geist-mono), Monaco, &quot;Cascadia Code&quot;, &quot;Roboto Mono&quot;, Consolas, &quot;Courier New&quot;, monospace; word-break: break-word;"><span><span class="token" style="color: rgb(106, 153, 85);">// Example function that resides within any Agent or MCP Tool</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(86, 156, 214);">function</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">example</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// ANALYTICS can be named to anything and equals the binding in wrangler.json</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> </span><span class="token" style="color: rgb(156, 220, 254);">ANALYTICS</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">this</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">env</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span></span></code></pre></div></div>
<h3 class="text-l font-semibold text-white/90 mt-6 mb-3 font-space-grotesk" id="data-writing-methods">Data Writing Methods</h3>
<p class="text-white/80 mb-4 font-space-grotesk"><strong><code class="bg-black/50 px-1 py-0.5 rounded text-green-400 font-mono text-sm">writeDataPoint(dataset: string, data: AnalyticsDataPoint): Promise&lt;void&gt;</code></strong><br>
Writes a single data point to the specified dataset. Use for individual events or metrics.</p>
<p class="text-white/80 mb-4 font-space-grotesk"><strong><code class="bg-black/50 px-1 py-0.5 rounded text-green-400 font-mono text-sm">writeDataPoints(dataset: string, data: AnalyticsDataPoint[]): Promise&lt;void&gt;</code></strong><br>
Writes multiple data points in a single batch operation. More efficient for bulk data ingestion.</p>
<h3 class="text-l font-semibold text-white/90 mt-6 mb-3 font-space-grotesk" id="query-methods">Query Methods</h3>
<p class="text-white/80 mb-4 font-space-grotesk"><strong><code class="bg-black/50 px-1 py-0.5 rounded text-green-400 font-mono text-sm">query(sql: string): Promise&lt;AnalyticsQueryResult&gt;</code></strong><br>
Executes a SQL query against your analytics data. Returns structured results with metadata.</p>
<p class="text-white/80 mb-4 font-space-grotesk"><strong><code class="bg-black/50 px-1 py-0.5 rounded text-green-400 font-mono text-sm">getMetrics(dataset: string, options: MetricsOptions): Promise&lt;MetricsResult&gt;</code></strong><br>
Predefined query helper for common metric aggregations with time ranges and grouping.</p>
<p class="text-white/80 mb-4 font-space-grotesk"><strong><code class="bg-black/50 px-1 py-0.5 rounded text-green-400 font-mono text-sm">getTimeSeries(dataset: string, metric: string, options: TimeSeriesOptions): Promise&lt;TimeSeriesResult&gt;</code></strong><br>
Specialized query for time-series data with automatic interval bucketing.</p>
<h3 class="text-l font-semibold text-white/90 mt-6 mb-3 font-space-grotesk" id="data-structures">Data Structures</h3>
<div class="code-block-container relative group my-6"><div class="flex items-center justify-between bg-[#1e1e1e] border border-white/10 border-b-0 rounded-t-lg px-4 py-2 text-sm"><span class="text-white/60 font-mono text-xs uppercase tracking-wider">typescript</span><button class="flex items-center gap-1.5 px-2 py-1 rounded text-xs transition-all duration-200 hover:bg-white/10 text-white/60 hover:text-white/80 focus:outline-none focus:ring-2 focus:ring-blue-500/50" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy h-3 w-3"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><div class="code-block-content bg-[#1e1e1e] border border-white/10 border-t-0 rounded-b-lg"><pre class="react-syntax-highlighter" style="color: rgb(212, 212, 212); font-size: 0.875rem; text-shadow: none; font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 4; hyphens: none; padding: 1rem; margin: 0px; overflow: visible; background: transparent; border-radius: 0.5rem; max-width: 100%;"><code style="white-space: pre-wrap; font-size: 0.875rem; line-height: 1.5; font-family: var(--font-geist-mono), Monaco, &quot;Cascadia Code&quot;, &quot;Roboto Mono&quot;, Consolas, &quot;Courier New&quot;, monospace; word-break: break-word;"><span><span class="token" style="color: rgb(86, 156, 214);">interface</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">AnalyticsDataPoint</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Required fields</span><span>
</span></span><span><span>  timestamp</span><span class="token" style="color: rgb(212, 212, 212);">?</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">number</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>           </span><span class="token" style="color: rgb(106, 153, 85);">// Unix timestamp (defaults to now)</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Optional dimensions (for grouping)</span><span>
</span></span><span><span>  dimensions</span><span class="token" style="color: rgb(212, 212, 212);">?</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    userId</span><span class="token" style="color: rgb(212, 212, 212);">?</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>    agentId</span><span class="token" style="color: rgb(212, 212, 212);">?</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>    messageType</span><span class="token" style="color: rgb(212, 212, 212);">?</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">[</span><span>key</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">]</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">|</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">number</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">|</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">boolean</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Metrics (numeric values)</span><span>
</span></span><span><span>  metrics</span><span class="token" style="color: rgb(212, 212, 212);">?</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    count</span><span class="token" style="color: rgb(212, 212, 212);">?</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">number</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>    duration</span><span class="token" style="color: rgb(212, 212, 212);">?</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">number</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>    tokens</span><span class="token" style="color: rgb(212, 212, 212);">?</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">number</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>    cost</span><span class="token" style="color: rgb(212, 212, 212);">?</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">number</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">[</span><span>key</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">]</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">number</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(86, 156, 214);">interface</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">MetricsOptions</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  timeRange</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    start</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">number</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>              </span><span class="token" style="color: rgb(106, 153, 85);">// Unix timestamp</span><span>
</span></span><span><span>    end</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">number</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>                </span><span class="token" style="color: rgb(106, 153, 85);">// Unix timestamp</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  dimensions</span><span class="token" style="color: rgb(212, 212, 212);">?</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">[</span><span class="token" style="color: rgb(212, 212, 212);">]</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>        </span><span class="token" style="color: rgb(106, 153, 85);">// Group by these dimensions</span><span>
</span></span><span><span>  metrics</span><span class="token" style="color: rgb(212, 212, 212);">?</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">[</span><span class="token" style="color: rgb(212, 212, 212);">]</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>           </span><span class="token" style="color: rgb(106, 153, 85);">// Include these metrics</span><span>
</span></span><span><span>  interval</span><span class="token" style="color: rgb(212, 212, 212);">?</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>            </span><span class="token" style="color: rgb(106, 153, 85);">// '1m', '5m', '1h', '1d'</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span></span></code></pre></div></div>
<h2 id="examples" class="text-xl font-bold text-white/90 mt-8 mb-4 font-space-grotesk">Examples</h2>
<p class="text-white/80 mb-4 font-space-grotesk">Each example demonstrates different analytics patterns for monitoring agent performance, billing tracking, A/B testing, and real-time system monitoring.</p>
<h3 class="text-l font-semibold text-white/90 mt-6 mb-3 font-space-grotesk" id="performance-monitoring-agent">Performance Monitoring Agent</h3>
<p class="text-white/80 mb-4 font-space-grotesk">Comprehensive agent performance tracking with error handling and user satisfaction metrics:</p>
<div class="code-block-container relative group my-6"><div class="flex items-center justify-between bg-[#1e1e1e] border border-white/10 border-b-0 rounded-t-lg px-4 py-2 text-sm"><span class="text-white/60 font-mono text-xs uppercase tracking-wider">typescript</span><button class="flex items-center gap-1.5 px-2 py-1 rounded text-xs transition-all duration-200 hover:bg-white/10 text-white/60 hover:text-white/80 focus:outline-none focus:ring-2 focus:ring-blue-500/50" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy h-3 w-3"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><div class="code-block-content bg-[#1e1e1e] border border-white/10 border-t-0 rounded-b-lg"><pre class="react-syntax-highlighter" style="color: rgb(212, 212, 212); font-size: 0.875rem; text-shadow: none; font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 4; hyphens: none; padding: 1rem; margin: 0px; overflow: visible; background: transparent; border-radius: 0.5rem; max-width: 100%;"><code style="white-space: pre-wrap; font-size: 0.875rem; line-height: 1.5; font-family: var(--font-geist-mono), Monaco, &quot;Cascadia Code&quot;, &quot;Roboto Mono&quot;, Consolas, &quot;Courier New&quot;, monospace; word-break: break-word;"><span><span class="token" style="color: rgb(106, 153, 85);">// Agent that tracks its own performance metrics</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(197, 134, 192);">export</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">async</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">function</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">processMessage</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>
</span></span><span><span>  sessionId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> messages</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">AIUISDKMessage</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>  platform</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">PlatformServices</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Promise</span><span class="token" style="color: rgb(212, 212, 212);">&lt;</span><span class="token" style="color: rgb(78, 201, 176);">AgentResponse</span><span class="token" style="color: rgb(212, 212, 212);">&gt;</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> memoryStore </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> platform</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> startTime </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Date</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">now</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">try</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(106, 153, 85);">// Step 1: Track incoming message metrics</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'agent_metrics'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        agentId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'performance-monitor'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        userId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        messageType</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">detectMessageType</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">content</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(106, 153, 85);">// "question", "command", "chat"</span><span>
</span></span><span><span>        source</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">metadata</span><span class="token" style="color: rgb(212, 212, 212);">?.</span><span>source </span><span class="token" style="color: rgb(212, 212, 212);">||</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'unknown'</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        messages_received</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">1</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        message_length</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">content</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">length</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>    
</span><span><span>    </span><span class="token" style="color: rgb(106, 153, 85);">// Step 2: Process the message (business logic)</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> response </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">generateResponse</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">content</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> processingTime </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Date</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">now</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">-</span><span> startTime</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>    
</span><span><span>    </span><span class="token" style="color: rgb(106, 153, 85);">// Step 3: Track successful response metrics</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'agent_metrics'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        agentId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'performance-monitor'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        userId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        messageType</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">detectMessageType</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">content</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        success</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'true'</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        responses_generated</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">1</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        processing_time_ms</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> processingTime</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        response_length</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> response</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">length</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        tokens_consumed</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">estimateTokens</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">content</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">+</span><span> response</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>    
</span><span><span>    </span><span class="token" style="color: rgb(106, 153, 85);">// Step 4: Track user satisfaction if feedback provided</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">if</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">metadata</span><span class="token" style="color: rgb(212, 212, 212);">?.</span><span>feedback</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'user_satisfaction'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>          agentId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'performance-monitor'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>          userId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>          rating</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">metadata</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">feedback</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">rating</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">toString</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(106, 153, 85);">// "1-5"</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>          satisfaction_score</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">metadata</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">feedback</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">rating</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>          feedback_count</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">1</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>    
</span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">return</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> response </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>    
</span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">catch</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>error</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> processingTime </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Date</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">now</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">-</span><span> startTime</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>    
</span><span><span>    </span><span class="token" style="color: rgb(106, 153, 85);">// Step 5: Track error metrics for debugging</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'agent_metrics'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        agentId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'performance-monitor'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        userId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        messageType</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">detectMessageType</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">content</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        success</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'false'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        error_type</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> error</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">name</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">||</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'unknown'</span><span> </span><span class="token" style="color: rgb(106, 153, 85);">// "TimeoutError", "ValidationError", etc.</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        errors_count</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">1</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        processing_time_ms</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> processingTime
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>    
</span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">throw</span><span> error</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(106, 153, 85);">// Analytics dashboard query agent</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(197, 134, 192);">export</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">async</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">function</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">generatePerformanceReport</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>
</span></span><span><span>  timeRange</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> start</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">number</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span> end</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">number</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>  platform</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">PlatformServices</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Promise</span><span class="token" style="color: rgb(212, 212, 212);">&lt;</span><span class="token" style="color: rgb(78, 201, 176);">PerformanceReport</span><span class="token" style="color: rgb(212, 212, 212);">&gt;</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> analytics </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> platform</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Query 1: Get overall performance metrics</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> performanceQuery </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">    SELECT 
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      agentId,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      COUNT(*) as total_messages,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      AVG(processing_time_ms) as avg_processing_time,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      SUM(CASE WHEN success = 'true' THEN 1 ELSE 0 END) as successful_messages,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      SUM(CASE WHEN success = 'false' THEN 1 ELSE 0 END) as failed_messages,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      AVG(tokens_consumed) as avg_tokens
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    FROM agent_metrics 
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">    WHERE timestamp &gt;= </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">timeRange</span><span class="token template-string" style="color: rgb(212, 212, 212);">.</span><span class="token template-string property-access" style="color: rgb(156, 220, 254);">start</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);"> AND timestamp &lt;= </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">timeRange</span><span class="token template-string" style="color: rgb(212, 212, 212);">.</span><span class="token template-string property-access" style="color: rgb(156, 220, 254);">end</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">    GROUP BY agentId
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    ORDER BY total_messages DESC
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">  </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> </span><span class="token dom" style="color: rgb(156, 220, 254);">performance</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">query</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>performanceQuery</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Query 2: Get hourly message trends</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> trendsQuery </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">    SELECT 
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      agentId,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      toStartOfHour(timestamp) as hour,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      COUNT(*) as messages_count,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      AVG(processing_time_ms) as avg_processing_time
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    FROM agent_metrics 
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">    WHERE timestamp &gt;= </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">timeRange</span><span class="token template-string" style="color: rgb(212, 212, 212);">.</span><span class="token template-string property-access" style="color: rgb(156, 220, 254);">start</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);"> AND timestamp &lt;= </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">timeRange</span><span class="token template-string" style="color: rgb(212, 212, 212);">.</span><span class="token template-string property-access" style="color: rgb(156, 220, 254);">end</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">    GROUP BY agentId, hour
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    ORDER BY hour ASC
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">  </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> trends </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">query</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>trendsQuery</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Query 3: Get user satisfaction scores</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> satisfactionQuery </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">    SELECT 
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      agentId,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      AVG(satisfaction_score) as avg_satisfaction,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      COUNT(*) as feedback_count
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    FROM user_satisfaction 
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">    WHERE timestamp &gt;= </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">timeRange</span><span class="token template-string" style="color: rgb(212, 212, 212);">.</span><span class="token template-string property-access" style="color: rgb(156, 220, 254);">start</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);"> AND timestamp &lt;= </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">timeRange</span><span class="token template-string" style="color: rgb(212, 212, 212);">.</span><span class="token template-string property-access" style="color: rgb(156, 220, 254);">end</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">    GROUP BY agentId
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">  </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> satisfaction </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">query</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>satisfactionQuery</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">return</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token dom" style="color: rgb(156, 220, 254);">performance</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token dom" style="color: rgb(156, 220, 254);">performance</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">data</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>    trends</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> trends</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">data</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>    satisfaction</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> satisfaction</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">data</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>    generatedAt</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Date</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">now</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span></span></code></pre></div></div>
<h3 class="text-l font-semibold text-white/90 mt-6 mb-3 font-space-grotesk" id="usage-based-billing-agent">Usage-Based Billing Agent</h3>
<p class="text-white/80 mb-4 font-space-grotesk">Track detailed resource usage and implement billing alerts for cost management:</p>
<div class="code-block-container relative group my-6"><div class="flex items-center justify-between bg-[#1e1e1e] border border-white/10 border-b-0 rounded-t-lg px-4 py-2 text-sm"><span class="text-white/60 font-mono text-xs uppercase tracking-wider">typescript</span><button class="flex items-center gap-1.5 px-2 py-1 rounded text-xs transition-all duration-200 hover:bg-white/10 text-white/60 hover:text-white/80 focus:outline-none focus:ring-2 focus:ring-blue-500/50" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy h-3 w-3"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><div class="code-block-content bg-[#1e1e1e] border border-white/10 border-t-0 rounded-b-lg"><pre class="react-syntax-highlighter" style="color: rgb(212, 212, 212); font-size: 0.875rem; text-shadow: none; font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 4; hyphens: none; padding: 1rem; margin: 0px; overflow: visible; background: transparent; border-radius: 0.5rem; max-width: 100%;"><code style="white-space: pre-wrap; font-size: 0.875rem; line-height: 1.5; font-family: var(--font-geist-mono), Monaco, &quot;Cascadia Code&quot;, &quot;Roboto Mono&quot;, Consolas, &quot;Courier New&quot;, monospace; word-break: break-word;"><span><span class="token" style="color: rgb(106, 153, 85);">// Agent that tracks usage for billing purposes</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(197, 134, 192);">export</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">async</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">function</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">processMessage</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>
</span></span><span><span>  sessionId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> messages</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">AIUISDKMessage</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>  platform</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">PlatformServices</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Promise</span><span class="token" style="color: rgb(212, 212, 212);">&lt;</span><span class="token" style="color: rgb(78, 201, 176);">AgentResponse</span><span class="token" style="color: rgb(212, 212, 212);">&gt;</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> memoryStore </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> platform</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Step 1: Get user's current billing plan</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> userPlan </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">getUserBillingPlan</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span> </span><span class="token" style="color: rgb(106, 153, 85);">// "free", "pro", "enterprise"</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> startTime </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Date</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">now</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Step 2: Track API call event</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'billing_events'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      userId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      plan</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> userPlan</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">tier</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      feature</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'message_processing'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      agent_type</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'billing-tracker'</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>    metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      api_calls</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">1</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      base_cost</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> userPlan</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">costPerMessage</span><span> </span><span class="token" style="color: rgb(106, 153, 85);">// $0.01, $0.005, etc.</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Step 3: Process message and measure resource consumption</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> response </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">generateResponse</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">content</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> processingTime </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Date</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">now</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">-</span><span> startTime</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> tokensUsed </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">estimateTokens</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">content</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">+</span><span> response</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Step 4: Calculate detailed costs based on usage</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> costs </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">calculateUsageCosts</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    tokensUsed</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>    processingTime</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>    plan</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> userPlan
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Step 5: Track detailed usage metrics for billing</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'usage_metrics'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      userId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      plan</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> userPlan</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">tier</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      model</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'gpt-4'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(106, 153, 85);">// LLM model used</span><span>
</span></span><span><span>      feature</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'text_generation'</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>    metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      tokens_consumed</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> tokensUsed</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      processing_time_ms</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> processingTime</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      compute_cost</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> costs</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">compute</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>    </span><span class="token" style="color: rgb(106, 153, 85);">// CPU/GPU costs</span><span>
</span></span><span><span>      token_cost</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> costs</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">tokens</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>       </span><span class="token" style="color: rgb(106, 153, 85);">// LLM API costs  </span><span>
</span></span><span><span>      total_cost</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> costs</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">total</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Step 6: Check for billing alerts (80% threshold)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> monthlyUsage </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">getMonthlyUsage</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">if</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>monthlyUsage</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">cost</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">&gt;</span><span> userPlan</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">monthlyLimit</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">*</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">0.8</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'billing_alerts'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        userId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        alert_type</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'usage_warning'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        plan</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> userPlan</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">tier</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        usage_percentage</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>monthlyUsage</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">cost</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">/</span><span> userPlan</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">monthlyLimit</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">*</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">100</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        remaining_budget</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> userPlan</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">monthlyLimit</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">-</span><span> monthlyUsage</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">cost</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>    
</span><span><span>    </span><span class="token" style="color: rgb(106, 153, 85);">// Send notification to user</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">sendBillingAlert</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      type</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'usage_warning'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      currentUsage</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> monthlyUsage</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">cost</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      limit</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> userPlan</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">monthlyLimit</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      percentage</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>monthlyUsage</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">cost</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">/</span><span> userPlan</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">monthlyLimit</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">*</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">100</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">return</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> response </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span></span></code></pre></div></div>
<h3 class="text-l font-semibold text-white/90 mt-6 mb-3 font-space-grotesk" id="a-b-testing-analytics-agent">A/B Testing Analytics Agent</h3>
<p class="text-white/80 mb-4 font-space-grotesk">Run experiments and analyze statistical significance of different agent variants:</p>
<div class="code-block-container relative group my-6"><div class="flex items-center justify-between bg-[#1e1e1e] border border-white/10 border-b-0 rounded-t-lg px-4 py-2 text-sm"><span class="text-white/60 font-mono text-xs uppercase tracking-wider">typescript</span><button class="flex items-center gap-1.5 px-2 py-1 rounded text-xs transition-all duration-200 hover:bg-white/10 text-white/60 hover:text-white/80 focus:outline-none focus:ring-2 focus:ring-blue-500/50" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy h-3 w-3"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><div class="code-block-content bg-[#1e1e1e] border border-white/10 border-t-0 rounded-b-lg"><pre class="react-syntax-highlighter" style="color: rgb(212, 212, 212); font-size: 0.875rem; text-shadow: none; font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 4; hyphens: none; padding: 1rem; margin: 0px; overflow: visible; background: transparent; border-radius: 0.5rem; max-width: 100%;"><code style="white-space: pre-wrap; font-size: 0.875rem; line-height: 1.5; font-family: var(--font-geist-mono), Monaco, &quot;Cascadia Code&quot;, &quot;Roboto Mono&quot;, Consolas, &quot;Courier New&quot;, monospace; word-break: break-word;"><span><span class="token" style="color: rgb(106, 153, 85);">// Agent that runs A/B tests and tracks results</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(197, 134, 192);">export</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">async</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">function</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">processMessage</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>
</span></span><span><span>  sessionId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> messages</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">AIUISDKMessage</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>  platform</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">PlatformServices</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Promise</span><span class="token" style="color: rgb(212, 212, 212);">&lt;</span><span class="token" style="color: rgb(78, 201, 176);">AgentResponse</span><span class="token" style="color: rgb(212, 212, 212);">&gt;</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> memoryStore </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> platform</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Step 1: Determine which test variants to use</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> activeTests </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">getActiveTests</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span> </span><span class="token" style="color: rgb(106, 153, 85);">// ["response_style_test", "greeting_test"]</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> userVariants </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">assignTestVariants</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> activeTests</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Example: { "response_style_test": "formal", "greeting_test": "friendly" }</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> startTime </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Date</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">now</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Step 2: Track test exposure events</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">for</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">[</span><span>testId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> variant</span><span class="token" style="color: rgb(212, 212, 212);">]</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">of</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Object</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">entries</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>userVariants</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'ab_test_exposure'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        test_id</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> testId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        variant</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> variant</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(106, 153, 85);">// "control", "variant_a", "variant_b"</span><span>
</span></span><span><span>        userId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        messageType</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">detectMessageType</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">content</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        exposures</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">1</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Step 3: Generate response using assigned test variants</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> response </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">generateResponseWithVariants</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">content</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> userVariants</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> processingTime </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Date</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">now</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">-</span><span> startTime</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Step 4: Track response metrics for each active test</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">for</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">[</span><span>testId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> variant</span><span class="token" style="color: rgb(212, 212, 212);">]</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">of</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Object</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">entries</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>userVariants</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'ab_test_metrics'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        test_id</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> testId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        variant</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> variant</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        userId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        success</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'true'</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        response_time_ms</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> processingTime</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        response_length</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> response</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">length</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        responses</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">1</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">return</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> 
</span></span><span><span>    message</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> response</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>    actions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">[</span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      type</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'ab_test_tracking'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      data</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> userVariants</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> processingTime </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">]</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span></span></code></pre></div></div>
<h3 class="text-l font-semibold text-white/90 mt-6 mb-3 font-space-grotesk" id="real-time-monitoring-agent">Real-Time Monitoring Agent</h3>
<p class="text-white/80 mb-4 font-space-grotesk">Monitor system health with automatic anomaly detection and alerting:</p>
<div class="code-block-container relative group my-6"><div class="flex items-center justify-between bg-[#1e1e1e] border border-white/10 border-b-0 rounded-t-lg px-4 py-2 text-sm"><span class="text-white/60 font-mono text-xs uppercase tracking-wider">typescript</span><button class="flex items-center gap-1.5 px-2 py-1 rounded text-xs transition-all duration-200 hover:bg-white/10 text-white/60 hover:text-white/80 focus:outline-none focus:ring-2 focus:ring-blue-500/50" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy h-3 w-3"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><div class="code-block-content bg-[#1e1e1e] border border-white/10 border-t-0 rounded-b-lg"><pre class="react-syntax-highlighter" style="color: rgb(212, 212, 212); font-size: 0.875rem; text-shadow: none; font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 4; hyphens: none; padding: 1rem; margin: 0px; overflow: visible; background: transparent; border-radius: 0.5rem; max-width: 100%;"><code style="white-space: pre-wrap; font-size: 0.875rem; line-height: 1.5; font-family: var(--font-geist-mono), Monaco, &quot;Cascadia Code&quot;, &quot;Roboto Mono&quot;, Consolas, &quot;Courier New&quot;, monospace; word-break: break-word;"><span><span class="token" style="color: rgb(106, 153, 85);">// Agent that monitors system health and alerts</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(197, 134, 192);">export</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">async</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">function</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">processMessage</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>
</span></span><span><span>  sessionId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> messages</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">AIUISDKMessage</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>  platform</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">PlatformServices</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Promise</span><span class="token" style="color: rgb(212, 212, 212);">&lt;</span><span class="token" style="color: rgb(78, 201, 176);">AgentResponse</span><span class="token" style="color: rgb(212, 212, 212);">&gt;</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> analytics </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> platform</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Step 1: Collect current system health metrics</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> healthMetrics </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">collectSystemHealthMetrics</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Returns: { cpu: 45.2, memory: 78.1, connections: 150, queueDepth: 5, errorRate: 0.02 }</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Step 2: Write system metrics to multiple datasets</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoints</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'system_health'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">[</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        service</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'message_processing'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        region</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'global'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        environment</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'production'</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        cpu_usage</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> healthMetrics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">cpu</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        memory_usage</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> healthMetrics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">memory</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        active_connections</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> healthMetrics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">connections</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        queue_depth</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> healthMetrics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">queueDepth</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        error_rate</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> healthMetrics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">errorRate</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        service</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'storage'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        region</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'global'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        environment</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'production'</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        storage_usage</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> healthMetrics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">storageUsage</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        read_latency</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> healthMetrics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">readLatency</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>    </span><span class="token" style="color: rgb(106, 153, 85);">// milliseconds</span><span>
</span></span><span><span>        write_latency</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> healthMetrics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">writeLatency</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// milliseconds</span><span>
</span></span><span><span>        throughput</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> healthMetrics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">throughput</span><span>        </span><span class="token" style="color: rgb(106, 153, 85);">// requests per second</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">]</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Step 3: Run anomaly detection algorithms</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> anomalies </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">detectAnomalies</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>healthMetrics</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Returns: [{ type: 'high_cpu', severity: 'warning', value: 95.2, threshold: 80 }]</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">if</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>anomalies</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">length</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">&gt;</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">0</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(106, 153, 85);">// Step 4: Track alert events</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">for</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> anomaly </span><span class="token" style="color: rgb(86, 156, 214);">of</span><span> anomalies</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'system_alerts'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>          alert_type</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> anomaly</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">type</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>        </span><span class="token" style="color: rgb(106, 153, 85);">// "high_cpu", "memory_leak", "queue_backup"</span><span>
</span></span><span><span>          severity</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> anomaly</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">severity</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>      </span><span class="token" style="color: rgb(106, 153, 85);">// "info", "warning", "critical"</span><span>
</span></span><span><span>          service</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> anomaly</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">service</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>          alert_count</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">1</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>          value</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> anomaly</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">value</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>          threshold</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> anomaly</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">threshold</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>    
</span><span><span>    </span><span class="token" style="color: rgb(106, 153, 85);">// Step 5: Send alerts to operations team</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">sendOperationalAlert</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      anomalies</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      timestamp</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Date</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">now</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      systemMetrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> healthMetrics
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>    
</span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">return</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      message</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token template-string" style="color: rgb(206, 145, 120);">System health check complete. </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">anomalies</span><span class="token template-string" style="color: rgb(212, 212, 212);">.</span><span class="token template-string property-access" style="color: rgb(156, 220, 254);">length</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);"> anomalies detected and alerts sent.</span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>      actions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> anomalies</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">map</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>a </span><span class="token" style="color: rgb(86, 156, 214);">=&gt;</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        type</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'anomaly_detected'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>        data</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> a
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">return</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    message</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">"System health check complete. All metrics within normal ranges."</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(106, 153, 85);">// Real-time dashboard data aggregation</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(86, 156, 214);">async</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">function</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">getDashboardData</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>platform</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">PlatformServices</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Promise</span><span class="token" style="color: rgb(212, 212, 212);">&lt;</span><span class="token" style="color: rgb(78, 201, 176);">DashboardData</span><span class="token" style="color: rgb(212, 212, 212);">&gt;</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> analytics </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> platform</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> now </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Date</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">now</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> oneHourAgo </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> now </span><span class="token" style="color: rgb(212, 212, 212);">-</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(181, 206, 168);">60</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">*</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">60</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">*</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">1000</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Query 1: Current system status (last 5 minutes)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> currentMetrics </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">query</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">    SELECT 
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      AVG(cpu_usage) as avg_cpu,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      AVG(memory_usage) as avg_memory,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      MAX(queue_depth) as max_queue_depth,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      AVG(error_rate) as avg_error_rate,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      COUNT(*) as metric_count
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    FROM system_health 
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">    WHERE timestamp &gt;= </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">now </span><span class="token template-string" style="color: rgb(212, 212, 212);">-</span><span class="token template-string" style="color: rgb(156, 220, 254);"> </span><span class="token template-string" style="color: rgb(181, 206, 168);">300000</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);"> -- Last 5 minutes
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">      AND service = 'message_processing'
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">  </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Query 2: Hourly trends for charts</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> hourlyTrends </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">query</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">    SELECT 
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      toStartOfMinute(timestamp) as minute,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      AVG(cpu_usage) as cpu,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      AVG(memory_usage) as memory,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      AVG(error_rate) as error_rate
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    FROM system_health 
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">    WHERE timestamp &gt;= </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">oneHourAgo</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">      AND service = 'message_processing'
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    GROUP BY minute
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    ORDER BY minute ASC
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">  </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Query 3: Active alerts summary</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> activeAlerts </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">query</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">    SELECT 
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      alert_type,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      severity,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      COUNT(*) as count,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      MAX(timestamp) as last_occurrence
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    FROM system_alerts 
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">    WHERE timestamp &gt;= </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">oneHourAgo</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">    GROUP BY alert_type, severity
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    ORDER BY count DESC
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">  </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">return</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    current</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> currentMetrics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">data</span><span class="token" style="color: rgb(212, 212, 212);">[</span><span class="token" style="color: rgb(181, 206, 168);">0</span><span class="token" style="color: rgb(212, 212, 212);">]</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>    trends</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> hourlyTrends</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">data</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>    alerts</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> activeAlerts</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">data</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>    lastUpdated</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> now
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span></span></code></pre></div></div>
<h2 id="best-practices" class="text-xl font-bold text-white/90 mt-8 mb-4 font-space-grotesk">Best Practices</h2>
<p class="text-white/80 mb-4 font-space-grotesk">Follow these patterns for optimal analytics performance and maintainability. Use consistent naming conventions and batch operations when possible.</p>
<h3 class="text-l font-semibold text-white/90 mt-6 mb-3 font-space-grotesk" id="efficient-data-modeling">Efficient Data Modeling</h3>
<p class="text-white/80 mb-4 font-space-grotesk">Choose appropriate dimension cardinality and use consistent naming conventions to optimize query performance and storage costs.</p>
<div class="code-block-container relative group my-6"><div class="flex items-center justify-between bg-[#1e1e1e] border border-white/10 border-b-0 rounded-t-lg px-4 py-2 text-sm"><span class="text-white/60 font-mono text-xs uppercase tracking-wider">typescript</span><button class="flex items-center gap-1.5 px-2 py-1 rounded text-xs transition-all duration-200 hover:bg-white/10 text-white/60 hover:text-white/80 focus:outline-none focus:ring-2 focus:ring-blue-500/50" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy h-3 w-3"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><div class="code-block-content bg-[#1e1e1e] border border-white/10 border-t-0 rounded-b-lg"><pre class="react-syntax-highlighter" style="color: rgb(212, 212, 212); font-size: 0.875rem; text-shadow: none; font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 4; hyphens: none; padding: 1rem; margin: 0px; overflow: visible; background: transparent; border-radius: 0.5rem; max-width: 100%;"><code style="white-space: pre-wrap; font-size: 0.875rem; line-height: 1.5; font-family: var(--font-geist-mono), Monaco, &quot;Cascadia Code&quot;, &quot;Roboto Mono&quot;, Consolas, &quot;Courier New&quot;, monospace; word-break: break-word;"><span><span class="token" style="color: rgb(106, 153, 85);">// ✅ Good: Use consistent dimension names and optimize for queries</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> standardDimensions </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  userId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>  agentId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'my-agent'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>  environment</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'production'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>  version</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'1.0.0'</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(106, 153, 85);">// ✅ Good: Batch data points for better performance</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> dataPoints </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> messages</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">map</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>msg </span><span class="token" style="color: rgb(86, 156, 214);">=&gt;</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token spread" style="color: rgb(212, 212, 212);">...</span><span>standardDimensions</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>    messageType</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">detectType</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>msg</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">content</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>  metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    processing_time</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> msg</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">processingTime</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>    tokens_used</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> msg</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">tokensUsed</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoints</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'agent_metrics'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> dataPoints</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(106, 153, 85);">// ❌ Bad: Inconsistent dimension names</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'metrics'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    user_id</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'user1'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>        </span><span class="token" style="color: rgb(106, 153, 85);">// Inconsistent naming</span><span>
</span></span><span><span>    agent</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'my-agent'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>       </span><span class="token" style="color: rgb(106, 153, 85);">// Missing 'Id' suffix</span><span>
</span></span><span><span>    env</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'prod'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>            </span><span class="token" style="color: rgb(106, 153, 85);">// Abbreviation instead of full name</span><span>
</span></span><span><span>    ver</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">'1.0'</span><span>              </span><span class="token" style="color: rgb(106, 153, 85);">// Different naming pattern</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(106, 153, 85);">// ❌ Bad: High cardinality dimensions (too many unique values)</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'metrics'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    userId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>
</span></span><span><span>    timestamp</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Date</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">now</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">toString</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Unique for every event</span><span>
</span></span><span><span>    messageContent</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">content</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>   </span><span class="token" style="color: rgb(106, 153, 85);">// Potentially unlimited values</span><span>
</span></span><span><span>    sessionId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">generateUUID</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span>          </span><span class="token" style="color: rgb(106, 153, 85);">// High cardinality</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(106, 153, 85);">// ❌ Bad: Individual writes instead of batching</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(197, 134, 192);">for</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> msg </span><span class="token" style="color: rgb(86, 156, 214);">of</span><span> messages</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'metrics'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> </span><span class="token" style="color: rgb(106, 153, 85);">/* data */</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span> </span><span class="token" style="color: rgb(106, 153, 85);">// Multiple network calls</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span></span></code></pre></div></div>
<h3 class="text-l font-semibold text-white/90 mt-6 mb-3 font-space-grotesk" id="query-optimization">Query Optimization</h3>
<p class="text-white/80 mb-4 font-space-grotesk">Write efficient SQL queries that filter early and use appropriate aggregations to minimize data transfer and processing time.</p>
<div class="code-block-container relative group my-6"><div class="flex items-center justify-between bg-[#1e1e1e] border border-white/10 border-b-0 rounded-t-lg px-4 py-2 text-sm"><span class="text-white/60 font-mono text-xs uppercase tracking-wider">typescript</span><button class="flex items-center gap-1.5 px-2 py-1 rounded text-xs transition-all duration-200 hover:bg-white/10 text-white/60 hover:text-white/80 focus:outline-none focus:ring-2 focus:ring-blue-500/50" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy h-3 w-3"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><div class="code-block-content bg-[#1e1e1e] border border-white/10 border-t-0 rounded-b-lg"><pre class="react-syntax-highlighter" style="color: rgb(212, 212, 212); font-size: 0.875rem; text-shadow: none; font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 4; hyphens: none; padding: 1rem; margin: 0px; overflow: visible; background: transparent; border-radius: 0.5rem; max-width: 100%;"><code style="white-space: pre-wrap; font-size: 0.875rem; line-height: 1.5; font-family: var(--font-geist-mono), Monaco, &quot;Cascadia Code&quot;, &quot;Roboto Mono&quot;, Consolas, &quot;Courier New&quot;, monospace; word-break: break-word;"><span><span class="token" style="color: rgb(106, 153, 85);">// ✅ Good: Use time range filters and appropriate aggregations</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> optimizedQuery </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">  SELECT 
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    agentId,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    toStartOfHour(timestamp) as hour,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    COUNT(*) as message_count,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    AVG(processing_time) as avg_processing_time
</span><span class="token template-string" style="color: rgb(206, 145, 120);">  FROM agent_metrics 
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">  WHERE timestamp &gt;= </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">startTime</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);"> 
</span></span><span><span class="token template-string" style="color: rgb(206, 145, 120);">    AND timestamp &lt;= </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">endTime</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">    AND agentId IN ('agent1', 'agent2') -- Filter early
</span><span class="token template-string" style="color: rgb(206, 145, 120);">  GROUP BY agentId, hour
</span><span class="token template-string" style="color: rgb(206, 145, 120);">  ORDER BY hour ASC
</span><span class="token template-string" style="color: rgb(206, 145, 120);">  LIMIT 1000
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);"></span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(106, 153, 85);">// ✅ Good: Use CTEs for complex queries</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> complexQuery </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">  WITH recent_data AS (
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    SELECT agentId, processing_time 
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    FROM agent_metrics 
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">    WHERE timestamp &gt;= </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">oneHourAgo</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">  ),
</span><span class="token template-string" style="color: rgb(206, 145, 120);">  aggregated AS (
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    SELECT 
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      agentId,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      AVG(processing_time) as avg_time,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">      COUNT(*) as total_count
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    FROM recent_data
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    GROUP BY agentId
</span><span class="token template-string" style="color: rgb(206, 145, 120);">  )
</span><span class="token template-string" style="color: rgb(206, 145, 120);">  SELECT * FROM aggregated 
</span><span class="token template-string" style="color: rgb(206, 145, 120);">  WHERE total_count &gt; 10
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);"></span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(106, 153, 85);">// ❌ Bad: No time range filters</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> badQuery </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">  SELECT * FROM agent_metrics  -- Scans entire dataset
</span><span class="token template-string" style="color: rgb(206, 145, 120);">  WHERE agentId = 'my-agent'
</span><span class="token template-string" style="color: rgb(206, 145, 120);">  ORDER BY timestamp DESC
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);"></span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(106, 153, 85);">// ❌ Bad: Inefficient aggregations</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> inefficientQuery </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">  SELECT 
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    userId,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    agentId,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    timestamp,
</span><span class="token template-string" style="color: rgb(206, 145, 120);">    processing_time
</span><span class="token template-string" style="color: rgb(206, 145, 120);">  FROM agent_metrics 
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">  WHERE timestamp &gt;= </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">startTime</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">  -- No aggregation, returns raw data
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);"></span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(106, 153, 85);">// ❌ Bad: Missing LIMIT causes large result sets</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> unlimitedQuery </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">  SELECT * FROM agent_metrics 
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);">  WHERE timestamp &gt;= </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">startTime</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);">
</span></span><span class="token template-string" style="color: rgb(206, 145, 120);">  -- No LIMIT, could return millions of rows
</span><span><span class="token template-string" style="color: rgb(206, 145, 120);"></span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token" style="color: rgb(212, 212, 212);">;</span></span></code></pre></div></div>
<h3 class="text-l font-semibold text-white/90 mt-6 mb-3 font-space-grotesk" id="error-handling">Error Handling</h3>
<p class="text-white/80 mb-4 font-space-grotesk">Implement graceful error handling to ensure analytics failures don't break your main application flow.</p>
<div class="code-block-container relative group my-6"><div class="flex items-center justify-between bg-[#1e1e1e] border border-white/10 border-b-0 rounded-t-lg px-4 py-2 text-sm"><span class="text-white/60 font-mono text-xs uppercase tracking-wider">typescript</span><button class="flex items-center gap-1.5 px-2 py-1 rounded text-xs transition-all duration-200 hover:bg-white/10 text-white/60 hover:text-white/80 focus:outline-none focus:ring-2 focus:ring-blue-500/50" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy h-3 w-3"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg><span>Copy</span></button></div><div class="code-block-content bg-[#1e1e1e] border border-white/10 border-t-0 rounded-b-lg"><pre class="react-syntax-highlighter" style="color: rgb(212, 212, 212); font-size: 0.875rem; text-shadow: none; font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 4; hyphens: none; padding: 1rem; margin: 0px; overflow: visible; background: transparent; border-radius: 0.5rem; max-width: 100%;"><code style="white-space: pre-wrap; font-size: 0.875rem; line-height: 1.5; font-family: var(--font-geist-mono), Monaco, &quot;Cascadia Code&quot;, &quot;Roboto Mono&quot;, Consolas, &quot;Courier New&quot;, monospace; word-break: break-word;"><span><span class="token" style="color: rgb(106, 153, 85);">// ✅ Good: Handle analytics failures gracefully</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(86, 156, 214);">async</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">function</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">safeWriteMetrics</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>analytics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">Analytics</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> dataset</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> data</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">AnalyticsDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">try</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>dataset</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> data</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">catch</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>error</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(78, 201, 176);">console</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">error</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'Analytics write failed:'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> error</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(106, 153, 85);">// Don't fail the main operation</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(106, 153, 85);">// ✅ Good: Retry logic for transient failures</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(86, 156, 214);">async</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">function</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">writeMetricsWithRetry</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>analytics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">Analytics</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> dataset</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> data</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">AnalyticsDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> maxRetries </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">3</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">let</span><span> attempt </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">0</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">while</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>attempt </span><span class="token" style="color: rgb(212, 212, 212);">&lt;</span><span> maxRetries</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">try</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>dataset</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> data</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(197, 134, 192);">return</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span> </span><span class="token" style="color: rgb(106, 153, 85);">// Success</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">catch</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>error</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>      attempt</span><span class="token" style="color: rgb(212, 212, 212);">++</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(197, 134, 192);">if</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>attempt </span><span class="token" style="color: rgb(212, 212, 212);">&gt;=</span><span> maxRetries</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(78, 201, 176);">console</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">error</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token template-string" style="color: rgb(206, 145, 120);">Analytics write failed after </span><span class="token template-string" style="color: rgb(86, 156, 214);">${</span><span class="token template-string" style="color: rgb(156, 220, 254);">maxRetries</span><span class="token template-string" style="color: rgb(86, 156, 214);">}</span><span class="token template-string" style="color: rgb(206, 145, 120);"> attempts:</span><span class="token template-string template-punctuation" style="color: rgb(206, 145, 120);">`</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> error</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(197, 134, 192);">return</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span> </span><span class="token" style="color: rgb(106, 153, 85);">// Give up gracefully</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>      
</span><span><span>      </span><span class="token" style="color: rgb(106, 153, 85);">// Exponential backoff</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">new</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Promise</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>resolve </span><span class="token" style="color: rgb(86, 156, 214);">=&gt;</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">setTimeout</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>resolve</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Math</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">pow</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(181, 206, 168);">2</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> attempt</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">*</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">1000</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(106, 153, 85);">// ✅ Good: Validate data before writing</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(86, 156, 214);">async</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">function</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">validateAndWrite</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>analytics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">Analytics</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> dataset</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> data</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">AnalyticsDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Check required fields</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">if</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(212, 212, 212);">!</span><span>data</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">dimensions</span><span class="token" style="color: rgb(212, 212, 212);">?.</span><span>agentId</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(78, 201, 176);">console</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">warn</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'Missing required agentId dimension'</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(197, 134, 192);">return</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Validate dimension cardinality</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">if</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Object</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">keys</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>data</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">dimensions</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">length</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">&gt;</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">20</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(78, 201, 176);">console</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">warn</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'Too many dimensions, truncating'</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>    data</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">dimensions</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Object</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">fromEntries</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>
</span></span><span><span>      </span><span class="token known-class-name" style="color: rgb(78, 201, 176);">Object</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">entries</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>data</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">dimensions</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">slice</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(181, 206, 168);">0</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(181, 206, 168);">20</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">safeWriteMetrics</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>analytics</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> dataset</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> data</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(106, 153, 85);">// ❌ Bad: Let analytics failures break main functionality</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(86, 156, 214);">async</span><span> </span><span class="token" style="color: rgb(86, 156, 214);">function</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">processMessage</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>sessionId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(206, 145, 120);">string</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> messages</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(78, 201, 176);">AIUISDKMessage</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Main business logic</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(86, 156, 214);">const</span><span> response </span><span class="token" style="color: rgb(212, 212, 212);">=</span><span> </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> </span><span class="token" style="color: rgb(220, 220, 170);">generateResponse</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span>message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">content</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// This could break the entire function</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'metrics'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>    dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span> userId</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> message</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token property-access">userId</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(197, 134, 192);">return</span><span> response</span><span class="token" style="color: rgb(212, 212, 212);">;</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(106, 153, 85);">// ❌ Bad: No error handling or validation</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(197, 134, 192);">await</span><span> analytics</span><span class="token" style="color: rgb(212, 212, 212);">.</span><span class="token method property-access" style="color: rgb(220, 220, 170);">writeDataPoint</span><span class="token" style="color: rgb(212, 212, 212);">(</span><span class="token" style="color: rgb(206, 145, 120);">'metrics'</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span> </span><span class="token" style="color: rgb(212, 212, 212);">{</span><span>
</span></span><span><span>  dimensions</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token null nil" style="color: rgb(86, 156, 214);">null</span><span class="token" style="color: rgb(212, 212, 212);">,</span><span>  </span><span class="token" style="color: rgb(106, 153, 85);">// Could cause errors</span><span>
</span></span><span><span>  metrics</span><span class="token" style="color: rgb(212, 212, 212);">:</span><span> </span><span class="token nil" style="color: rgb(86, 156, 214);">undefined</span><span> </span><span class="token" style="color: rgb(106, 153, 85);">// Invalid data</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(212, 212, 212);">}</span><span class="token" style="color: rgb(212, 212, 212);">)</span><span class="token" style="color: rgb(212, 212, 212);">;</span></span></code></pre></div></div>
<h2 id="limitations--considerations" class="text-xl font-bold text-white/90 mt-8 mb-4 font-space-grotesk">Limitations &amp; Considerations</h2>
<ul class="list-disc pl-6 space-y-2 mb-4 text-white/80 font-space-grotesk">
<li class="text-white/80 font-space-grotesk"><strong>Data Point Size</strong>: Maximum 25 fields per data point</li>
<li class="text-white/80 font-space-grotesk"><strong>String Length</strong>: Maximum 256 characters per string field</li>
<li class="text-white/80 font-space-grotesk"><strong>Write Rate</strong>: Up to 25,000 data points per minute per dataset</li>
<li class="text-white/80 font-space-grotesk"><strong>Retention</strong>: Data retained for 3 months by default</li>
<li class="text-white/80 font-space-grotesk"><strong>Query Complexity</strong>: Limited to 1000 result rows per query</li>
</ul>
<h2 id="related-services" class="text-xl font-bold text-white/90 mt-8 mb-4 font-space-grotesk">Related Services</h2>
<ul class="list-disc pl-6 space-y-2 mb-4 text-white/80 font-space-grotesk">
<li class="text-white/80 font-space-grotesk"><strong><a class="text-[#7E98FF] hover:text-[#7E98FF] hover:underline font-space-grotesk" href="https://nullshot.ai/en/developers/platform/memory-store">Memory Store (KV)</a></strong> - Store analytics configurations and cache query results</li>
<li class="text-white/80 font-space-grotesk"><strong><a class="text-[#7E98FF] hover:text-[#7E98FF] hover:underline font-space-grotesk" href="https://nullshot.ai/en/developers/platform/queues">Queues</a></strong> - Buffer high-volume analytics data</li>
<li class="text-white/80 font-space-grotesk"><strong><a class="text-[#7E98FF] hover:text-[#7E98FF] hover:underline font-space-grotesk" href="https://nullshot.ai/en/developers/platform/logs">Logs</a></strong> - Detailed debugging information to complement metrics</li>
</ul></div></div><div class="mt-12 flex flex-col md:flex-row gap-4"><a class="md:flex-1 rounded-lg border border-white/20 p-4 md:p-6 text-white/80 hover:text-white transition-colors group hover:border-white/40" href="https://nullshot.ai/en/docs/developers/platform/overview"><div class="flex items-center justify-between"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-left h-5 w-5 text-blue-400 group-hover:text-blue-300 transition-colors flex-shrink-0"><path d="m15 18-6-6 6-6"></path></svg><div class="min-w-0 text-right"><div class="text-sm text-white/60 font-space-grotesk mb-1">Previous</div><div class="text-base font-medium font-space-grotesk truncate">Overview</div></div></div></a><a class="md:flex-1 rounded-lg border border-white/20 p-4 md:p-6 text-white/80 hover:text-white transition-colors group hover:border-white/40" href="https://nullshot.ai/en/docs/developers/platform/cache"><div class="flex items-center justify-between"><div class="min-w-0 text-left"><div class="text-sm text-white/60 font-space-grotesk mb-1">Next</div><div class="text-base font-medium font-space-grotesk truncate">Cache</div></div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-5 w-5 text-blue-400 group-hover:text-blue-300 transition-colors flex-shrink-0"><path d="m9 18 6-6-6-6"></path></svg></div></a></div></div></div></div></div></div></main><footer class="w-full relative bg-[#14161D] border-t border-white/12"><div class="max-w-[1440px] mx-auto px-4 sm:px-6 md:px-[80px] py-[40px] md:py-[60px]"><div class="hidden md:flex flex-col items-center gap-8 w-full"><div class="flex justify-between items-center w-full"><a class="flex items-center cursor-pointer" href="https://nullshot.ai/en"><img alt="NullShot" loading="lazy" width="147" height="36" decoding="async" data-nimg="1" class="object-contain" src="./Analytics Engine _ NullShot_files/logo.svg" style="color: transparent; filter: url(&quot;#logo-gradient&quot;);"><svg width="0" height="0"><defs><lineargradient id="logo-gradient" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#997EDE"></stop><stop offset="100%" stop-color="#77A7FF"></stop></lineargradient></defs></svg></a><div class="flex items-center gap-6"><a class="flex items-center gap-2 group" href="https://nullshot.ai/exchange"><div class="w-6 h-6 relative opacity-60 group-hover:opacity-100 transition-opacity duration-200"><img alt="Exchange" loading="lazy" width="24" height="24" decoding="async" data-nimg="1" class="object-contain" src="./Analytics Engine _ NullShot_files/exchange-icon.svg" style="color: transparent;"></div><span class="text-white/60 font-space-grotesk font-bold text-base group-hover:text-white transition-colors">Exchange</span></a><a class="flex items-center gap-2 group" href="https://nullshot.ai/playground"><div class="w-6 h-6 relative opacity-60 group-hover:opacity-100 transition-opacity duration-200"><img alt="Playground" loading="lazy" width="24" height="24" decoding="async" data-nimg="1" class="object-contain" src="./Analytics Engine _ NullShot_files/playground-icon.svg" style="color: transparent;"></div><span class="text-white/60 font-space-grotesk font-bold text-base group-hover:text-white transition-colors">Playground</span></a><a class="flex items-center gap-2 group" href="https://nullshot.ai/brainstorm"><div class="w-6 h-6 relative opacity-60 group-hover:opacity-100 transition-opacity duration-200"><img alt="Brainstorm" loading="lazy" width="24" height="24" decoding="async" data-nimg="1" class="object-contain" src="./Analytics Engine _ NullShot_files/brainstorm-icon.svg" style="color: transparent;"></div><span class="text-white/60 font-space-grotesk font-bold text-base group-hover:text-white transition-colors">Brainstorm</span></a><a class="flex items-center gap-2 group" href="https://nullshot.ai/en/blog"><div class="w-6 h-6 relative opacity-60 group-hover:opacity-100 transition-opacity duration-200"><img alt="Blog" loading="lazy" width="24" height="24" decoding="async" data-nimg="1" class="object-contain" src="./Analytics Engine _ NullShot_files/blogs-icon.svg" style="color: transparent;"></div><span class="text-white/60 font-space-grotesk font-bold text-base group-hover:text-white transition-colors">Blog</span></a><a class="flex items-center gap-2 group" href="https://nullshot.ai/en/docs"><div class="w-6 h-6 relative opacity-60 group-hover:opacity-100 transition-opacity duration-200"><img alt="Docs" loading="lazy" width="24" height="24" decoding="async" data-nimg="1" class="object-contain" src="./Analytics Engine _ NullShot_files/docs-icon.svg" style="color: transparent;"></div><span class="text-white/60 font-space-grotesk font-bold text-base group-hover:text-white transition-colors">Docs</span></a></div><div class="flex gap-5 items-center"><a href="https://x.com/_nullshot_" target="_blank" rel="noopener noreferrer" class="w-8 h-8 rounded-full bg-gradient-to-r from-[#7849EF]/30 to-[#326CD8]/30 flex items-center justify-center border border-gradient-to-r from-[#7849EF] to-[#326CD8] hover:scale-105 transition-transform"><img alt="X (Twitter)" loading="lazy" width="14" height="14" decoding="async" data-nimg="1" class="object-contain" src="./Analytics Engine _ NullShot_files/twitter-icon.svg" style="color: transparent;"></a><a href="https://github.com/null-shot" target="_blank" rel="noopener noreferrer" class="w-8 h-8 rounded-full bg-gradient-to-r from-[#7849EF]/30 to-[#326CD8]/30 flex items-center justify-center border border-gradient-to-r from-[#7849EF] to-[#326CD8] hover:scale-105 transition-transform"><img alt="GitHub" loading="lazy" width="15" height="15" decoding="async" data-nimg="1" class="object-contain" src="./Analytics Engine _ NullShot_files/github-icon.svg" style="color: transparent;"></a><a href="https://t.me/nullshotai" target="_blank" rel="noopener noreferrer" class="w-8 h-8 rounded-full bg-gradient-to-r from-[#7849EF]/30 to-[#326CD8]/30 flex items-center justify-center border border-gradient-to-r from-[#7849EF] to-[#326CD8] hover:scale-105 transition-transform"><img alt="Telegram" loading="lazy" width="14" height="11" decoding="async" data-nimg="1" class="object-contain" src="./Analytics Engine _ NullShot_files/telegram-icon.svg" style="color: transparent;"></a><a href="https://discord.gg/acwpp6zWEc" target="_blank" rel="noopener noreferrer" class="w-8 h-8 rounded-full bg-gradient-to-r from-[#7849EF]/30 to-[#326CD8]/30 flex items-center justify-center border border-gradient-to-r from-[#7849EF] to-[#326CD8] hover:scale-105 transition-transform"><img alt="Discord" loading="lazy" width="15" height="12" decoding="async" data-nimg="1" class="object-contain" src="./Analytics Engine _ NullShot_files/discord-icon.svg" style="color: transparent;"></a></div></div><div class="w-full h-[1px] bg-[hsl(var(--border))]"></div><div class="flex justify-between items-center w-full"><div class="text-white/60 font-space-grotesk text-sm">©Copyright 2025, All Rights Reserved by NullShot</div><div class="flex items-center gap-5"><a class="text-white/60 font-space-grotesk text-sm hover:text-white/80 transition-colors" href="https://nullshot.ai/privacy">Privacy Policy</a><a class="text-white/60 font-space-grotesk text-sm hover:text-white/80 transition-colors" href="https://nullshot.ai/tos">Terms &amp; Conditions</a></div></div></div><div class="flex md:hidden flex-col items-center gap-8 w-full"><div class="flex flex-col w-full gap-8"><a class="flex items-center cursor-pointer" href="https://nullshot.ai/en"><img alt="NullShot" loading="lazy" width="98" height="24" decoding="async" data-nimg="1" class="object-contain" src="./Analytics Engine _ NullShot_files/logo.svg" style="color: transparent;"></a><div class="flex justify-between items-start w-full gap-6"><div class="flex flex-col gap-4"><h4 class="text-white font-space-grotesk font-bold text-sm">Explore →</h4><div class="flex flex-col gap-3"><a class="flex items-center gap-1.5 group" href="https://nullshot.ai/brainstorm"><div class="w-4 h-4 relative opacity-60 group-hover:opacity-100 transition-opacity duration-200"><img alt="Brainstorm" loading="lazy" width="16" height="16" decoding="async" data-nimg="1" class="object-contain" src="./Analytics Engine _ NullShot_files/brainstorm-icon.svg" style="color: transparent;"></div><span class="text-white/60 font-space-grotesk text-xs group-hover:text-white transition-colors">Brainstorm</span></a><a class="flex items-center gap-1.5 group" href="https://nullshot.ai/exchange"><div class="w-4 h-4 relative opacity-60 group-hover:opacity-100 transition-opacity duration-200"><img alt="Exchange" loading="lazy" width="16" height="16" decoding="async" data-nimg="1" class="object-contain" src="./Analytics Engine _ NullShot_files/exchange-icon.svg" style="color: transparent;"></div><span class="text-white/60 font-space-grotesk text-xs group-hover:text-white transition-colors">Exchange</span></a><a class="flex items-center gap-1.5 group" href="https://nullshot.ai/playground"><div class="w-4 h-4 relative opacity-60 group-hover:opacity-100 transition-opacity duration-200"><img alt="Playground" loading="lazy" width="16" height="16" decoding="async" data-nimg="1" class="object-contain" src="./Analytics Engine _ NullShot_files/playground-icon.svg" style="color: transparent;"></div><span class="text-white/60 font-space-grotesk text-xs group-hover:text-white transition-colors">Playground</span></a></div></div><div class="flex flex-col gap-4"><h4 class="text-white font-space-grotesk font-bold text-sm">Resources</h4><div class="flex flex-col gap-3"><a class="flex items-center gap-1.5 group" href="https://nullshot.ai/en/blog"><div class="w-4 h-4 relative opacity-60 group-hover:opacity-100 transition-opacity duration-200"><img alt="Blog" loading="lazy" width="16" height="16" decoding="async" data-nimg="1" class="object-contain" src="./Analytics Engine _ NullShot_files/blogs-icon.svg" style="color: transparent;"></div><span class="text-white/60 font-space-grotesk text-xs group-hover:text-white transition-colors">Blogs</span></a><a class="flex items-center gap-1.5 group" href="https://nullshot.ai/en/docs"><div class="w-4 h-4 relative opacity-60 group-hover:opacity-100 transition-opacity duration-200"><img alt="Docs" loading="lazy" width="16" height="16" decoding="async" data-nimg="1" class="object-contain" src="./Analytics Engine _ NullShot_files/docs-icon.svg" style="color: transparent;"></div><span class="text-white/60 font-space-grotesk text-xs group-hover:text-white transition-colors">Docs</span></a></div></div><div class="flex flex-col gap-4"><h4 class="text-white font-space-grotesk font-bold text-sm">Socials</h4><div class="flex flex-col gap-3"><a href="https://discord.gg/acwpp6zWEc" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5"><div class="w-3.5 h-3.5 relative flex items-center justify-center"><img alt="Discord" loading="lazy" width="12" height="9" decoding="async" data-nimg="1" class="object-contain" src="./Analytics Engine _ NullShot_files/discord-icon.svg" style="color: transparent;"></div><span class="text-white/60 font-space-grotesk text-xs">Discord</span></a><a href="https://github.com/null-shot" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5"><div class="w-3.5 h-3.5 relative flex items-center justify-center"><img alt="GitHub" loading="lazy" width="12" height="12" decoding="async" data-nimg="1" class="object-contain" src="./Analytics Engine _ NullShot_files/github-icon.svg" style="color: transparent;"></div><span class="text-white/60 font-space-grotesk text-xs">Github</span></a><a href="https://t.me/nullshotai" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5"><div class="w-3.5 h-3.5 relative flex items-center justify-center"><img alt="Telegram" loading="lazy" width="11" height="8" decoding="async" data-nimg="1" class="object-contain" src="./Analytics Engine _ NullShot_files/telegram-icon.svg" style="color: transparent;"></div><span class="text-white/60 font-space-grotesk text-xs">Telegram</span></a><a href="https://x.com/_nullshot_" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5"><div class="w-3.5 h-3.5 relative flex items-center justify-center"><img alt="X (Twitter)" loading="lazy" width="11" height="11" decoding="async" data-nimg="1" class="object-contain" src="./Analytics Engine _ NullShot_files/twitter-icon.svg" style="color: transparent;"></div><span class="text-white/60 font-space-grotesk text-xs">Twitter</span></a></div></div></div></div><div class="flex flex-col items-center gap-3 w-full"><div class="w-full h-[1px] bg-[hsl(var(--border))]"></div><div class="text-white/60 font-space-grotesk text-xs text-center">©NullShot 2025, All Rights Reserved by NullShot</div><div class="flex items-center gap-5"><a class="text-white/60 font-space-grotesk text-xs hover:text-white/80 transition-colors" href="https://nullshot.ai/privacy">Privacy Policy</a><a class="text-white/60 font-space-grotesk text-xs hover:text-white/80 transition-colors" href="https://nullshot.ai/tos">Terms &amp; Conditions</a></div></div></div></div></footer></div></div><div role="region" aria-label="Notifications (F8)" tabindex="-1" style="pointer-events:none"><ol tabindex="-1" class="fixed top-[100px] right-4 z-[100] flex max-h-screen w-full flex-col max-w-[240px]"></ol></div><script src="./Analytics Engine _ NullShot_files/webpack-c07b3e4c8b34ec25.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[81043,[\"99386\",\"static/chunks/7d384bb9-0ffedcc6b53f3e73.js\",\"803\",\"static/chunks/cd24890f-ec7b64c510add751.js\",\"14081\",\"static/chunks/14081-3a328a513f1860b8.js\",\"66766\",\"static/chunks/66766-93aa4a3d196b6d8b.js\",\"6874\",\"static/chunks/6874-5100f18710e9cb3f.js\",\"61337\",\"static/chunks/61337-fe5b1b874c13fe78.js\",\"95630\",\"static/chunks/95630-9aae64d8aac2f285.js\",\"31928\",\"static/chunks/31928-70a661b25895e6e5.js\",\"57875\",\"static/chunks/57875-6609a7eb2a870f03.js\",\"37742\",\"static/chunks/37742-88327bccd3a920a3.js\",\"89329\",\"static/chunks/89329-9fb50cc5122e0593.js\",\"4228\",\"static/chunks/4228-aa6df1d124ddc104.js\",\"57220\",\"static/chunks/57220-384f521032e96b7b.js\",\"21108\",\"static/chunks/21108-625e01f465d840ea.js\",\"7177\",\"static/chunks/app/layout-daa5c86b9be15eb1.js\"],\"PostHogProvider\"]\n3:I[61483,[\"99386\",\"static/chunks/7d384bb9-0ffedcc6b53f3e73.js\",\"803\",\"static/chunks/cd24890f-ec7b64c510add751.js\",\"14081\",\"static/chunks/14081-3a328a513f1860b8.js\",\"66766\",\"static/chunks/66766-93aa4a3d196b6d8b.js\",\"6874\",\"static/chunks/6874-5100f18710e9cb3f.js\",\"61337\",\"static/chunks/61337-fe5b1b874c13fe78.js\",\"95630\",\"static/chunks/95630-9aae64d8aac2f285.js\",\"31928\",\"static/chunks/31928-70a661b25895e6e5.js\",\"57875\",\"static/chunks/57875-6609a7eb2a870f03.js\",\"37742\",\"static/chunks/37742-88327bccd3a920a3.js\",\"89329\",\"static/chunks/89329-9fb50cc5122e0593.js\",\"4228\",\"static/chunks/4228-aa6df1d124ddc104.js\",\"57220\",\"static/chunks/57220-384f521032e96b7b.js\",\"21108\",\"static/chunks/21108-625e01f465d840ea.js\",\"7177\",\"static/chunks/app/layout-daa5c86b9be15eb1.js\"],\"ThemeProvider\"]\n4:I[75662,[\"99386\",\"static/chunks/7d384bb9-0ffedcc6b53f3e73.js\",\"803\",\"static/chunks/cd24890f-ec7b64c510add751.js\",\"14081\",\"static/chunks/14081-3a328a513f1860b8.js\",\"66766\",\"static/chunks/66766-93aa4a3d196b6d8b.js\",\"6874\",\"static/chunks/6874-5100f18710e9cb3f.js\",\"61337\",\"static/chunks/61337-fe5b1b874c13fe78.js\",\"95630\",\"static/chunks/95630-9aae64d8aac2f285.js\",\"31928\",\"static/chunks/31928-70a661b25895e6e5.js\",\"57875\",\"static/chunks/57875-6609a7eb2a870f03.js\",\"37742\",\"static/chunks/37742-88327bccd3a920a3.js\",\"89329\",\"static/chunks/89329-9fb50cc5122e0593.js\",\"4228\",\"static/chunks/4228-aa6df1d124ddc104.js\",\"57220\",\"static/chunks/57220-384f521032e96b7b.js\",\"21108\",\"static/chunks/21108-625e01f465d840ea.js\",\"7177\",\"static/chunks/app/layout-daa5c86b9be15eb1.js\"],\"SessionProvider\"]\n5:I[76868,[\"99386\",\"static/chunks/7d384bb9-0ffedcc6b53f3e73.js\",\"803\",\"static/chunks/cd24890f-ec7b64c510add751.js\",\"14081\",\"static/chunks/14081-3a328a513f1860b8.js\",\"66766\",\"static/chunks/66766-93aa4a3d196b6d8b.js\",\"6874\",\"static/chunks/6874-5100f18710e9cb3f.js\",\"61337\",\"static/chunks/61337-fe5b1b874c13fe78.js\",\"95630\",\"static/chunks/95630-9aae64d8aac2f285.js\",\"31928\",\"static/chunks/31928-70a661b25895e6e5.js\",\"57875\",\"static/chunks/57875-6609a7eb2a870f03.js\",\"37742\",\"static/chunks/37742-88327bccd3a920a3.js\",\"89329\",\"static/chunks/89329-9fb50cc5122e0593.js\",\"4228\",\"static/chunks/4228-aa6df1d124ddc104.js\",\"57220\",\"static/chunks/57220-384f521032e96b7b.js\",\"21108\",\"static/chunks/21108-625e01f465d840ea.js\",\"7177\",\"static/chunks/app/layout-daa5c86b9be15eb1.js\"],\"ApolloWrapper\"]\n6:I[87555,[],\"\"]\n7:I[31295,[],\"\"]\n8:I[76479,[\"99386\",\"static/chunks/7d384bb9-0ffedcc6b53f3e73.js\",\"803\",\"static/chunks/cd24890f-ec7b64c510add751.js\",\"14081\",\"static/chunks/14081-3a328a513f1860b8.js\",\"66766\",\"static/chunks/66766-93aa4a3d196b6d8b.js\",\"6874\",\"static/chunks/6874-5100f18710e9cb3f.js\",\"61337\",\"static/chunks/61337-fe5b1b874c13fe78.js\",\"95630\",\"static/chunks/95630-9aae64d8aac2f285.js\",\"31928\",\"static/chunks/31928-70a661b25895e6e5.js\",\"57875\",\"static/chunks/57875-6609a7eb2a870f03.js\",\"37742\",\"static/chunks/37742-88327bccd3a920a3.js\",\"89329\",\"static/chunks/89329-9fb50cc5122e0593.js\",\"4228\",\"static/chunks/4228-aa6df1d124ddc104.js\",\"57220\",\"static/chunks/57220-384f521032e96b7b.js\",\"21108\",\"static/chunks/21108-625e01f465d840ea.js\",\"7177\",\"static/chunks/app/layout-daa5c86b9be15eb1.js\"],\"WelcomeModalGate\"]\n9:I[81397,[\"99386\",\"static/chunks/7d384bb9-0ffedcc6b53f3e73.js\",\"803\",\"static/chunks/cd24890f-ec7b64c510add751.js\",\"140"])</script><script>self.__next_f.push([1,"81\",\"static/chunks/14081-3a328a513f1860b8.js\",\"66766\",\"static/chunks/66766-93aa4a3d196b6d8b.js\",\"6874\",\"static/chunks/6874-5100f18710e9cb3f.js\",\"61337\",\"static/chunks/61337-fe5b1b874c13fe78.js\",\"95630\",\"static/chunks/95630-9aae64d8aac2f285.js\",\"31928\",\"static/chunks/31928-70a661b25895e6e5.js\",\"57875\",\"static/chunks/57875-6609a7eb2a870f03.js\",\"37742\",\"static/chunks/37742-88327bccd3a920a3.js\",\"89329\",\"static/chunks/89329-9fb50cc5122e0593.js\",\"4228\",\"static/chunks/4228-aa6df1d124ddc104.js\",\"57220\",\"static/chunks/57220-384f521032e96b7b.js\",\"21108\",\"static/chunks/21108-625e01f465d840ea.js\",\"7177\",\"static/chunks/app/layout-daa5c86b9be15eb1.js\"],\"Toaster\"]\na:I[69243,[\"99386\",\"static/chunks/7d384bb9-0ffedcc6b53f3e73.js\",\"803\",\"static/chunks/cd24890f-ec7b64c510add751.js\",\"14081\",\"static/chunks/14081-3a328a513f1860b8.js\",\"66766\",\"static/chunks/66766-93aa4a3d196b6d8b.js\",\"6874\",\"static/chunks/6874-5100f18710e9cb3f.js\",\"61337\",\"static/chunks/61337-fe5b1b874c13fe78.js\",\"95630\",\"static/chunks/95630-9aae64d8aac2f285.js\",\"31928\",\"static/chunks/31928-70a661b25895e6e5.js\",\"57875\",\"static/chunks/57875-6609a7eb2a870f03.js\",\"37742\",\"static/chunks/37742-88327bccd3a920a3.js\",\"89329\",\"static/chunks/89329-9fb50cc5122e0593.js\",\"4228\",\"static/chunks/4228-aa6df1d124ddc104.js\",\"57220\",\"static/chunks/57220-384f521032e96b7b.js\",\"21108\",\"static/chunks/21108-625e01f465d840ea.js\",\"7177\",\"static/chunks/app/layout-daa5c86b9be15eb1.js\"],\"\"]\nf:I[28393,[],\"\"]\n11:I[59665,[],\"OutletBoundary\"]\n13:I[74911,[],\"AsyncMetadataOutlet\"]\n15:I[59665,[],\"ViewportBoundary\"]\n17:I[59665,[],\"MetadataBoundary\"]\n18:\"$Sreact.suspense\"\n1a:I[15042,[\"99386\",\"static/chunks/7d384bb9-0ffedcc6b53f3e73.js\",\"14081\",\"static/chunks/14081-3a328a513f1860b8.js\",\"66766\",\"static/chunks/66766-93aa4a3d196b6d8b.js\",\"6874\",\"static/chunks/6874-5100f18710e9cb3f.js\",\"61337\",\"static/chunks/61337-fe5b1b874c13fe78.js\",\"95630\",\"static/chunks/95630-9aae64d8aac2f285.js\",\"31928\",\"static/chunks/31928-70a661b25895e6e5.js\",\"39526\",\"static/chunks/39526-1f72852a19518691.js\",\"81489\",\"static/chunks/81489-364437be73f42e0d.js\",\"57875\",\"static/chunks/57875-6609a7eb2a870f03.js\",\"57220\",\"static/chunks/57220-384f521032e96b7b.js\",\"21108\",\"static/chunks/21108-625e01f465d840ea.js\",\"15042\",\"static/chunks/15042-dde24db1fd73b409.js\",\"73317\",\"static/chunks/73317-ed887098e222ed78.js\",\"98450\",\"static/chunks/app/%5Blocale%5D/layout-8f83607456863de9.js\"],\"Navbar\"]\n1b:I[41072,[\"99386\",\"static/chunks/7d384bb9-0ffedcc6b53f3e73.js\",\"14081\",\"static/chunks/14081-3a328a513f1860b8.js\",\"66766\",\"static/chunks/66766-93aa4a3d196b6d8b.js\",\"6874\",\"static/chunks/6874-5100f18710e9cb3f.js\",\"61337\",\"static/chunks/61337-fe5b1b874c13fe78.js\",\"95630\",\"static/chunks/95630-9aae64d8aac2f285.js\",\"31928\",\"static/chunks/31928-70a661b25895e6e5.js\",\"39526\",\"static/chunks/39526-1f72852a19518691.js\",\"81489\",\"static/chunks/81489-364437be73f42e0d.js\",\"57875\",\"static/chunks/57875-6609a7eb2a870f03.js\",\"57220\",\"static/chunks/57220-384f521032e96b7b.js\",\"21108\",\"static/chunks/21108-625e01f465d840ea.js\",\"15042\",\"static/chunks/15042-dde24db1fd73b409.js\",\"73317\",\"static/chunks/73317-ed887098e222ed78.js\",\"98450\",\"static/chunks/app/%5Blocale%5D/layout-8f83607456863de9.js\"],\"ConditionalFooter\"]\n1c:I[38175,[],\"IconMark\"]\n1d:I[94990,[\"14081\",\"static/chunks/14081-3a328a513f1860b8.js\",\"66766\",\"static/chunks/66766-93aa4a3d196b6d8b.js\",\"6874\",\"static/chunks/6874-5100f18710e9cb3f.js\",\"92442\",\"static/chunks/92442-3de83d30df656bfc.js\",\"55779\",\"static/chunks/app/%5Blocale%5D/docs/%5B...slug%5D/page-4084506d579935d5.js\"],\"DocContent\"]\n1f:I[47033,[\"14081\",\"static/chunks/14081-3a328a513f1860b8.js\",\"6874\",\"static/chunks/6874-5100f18710e9cb3f.js\",\"61337\",\"static/chunks/61337-fe5b1b874c13fe78.js\",\"68679\",\"static/chunks/68679-e7d59f5e228a6339.js\",\"50794\",\"static/chunks/app/%5Blocale%5D/docs/layout-7d507a6a998fafbd.js\"],\"SidebarWithPath\"]\n20:I[87086,[\"14081\",\"static/chunks/14081-3a328a513f1860b8.js\",\"6874\",\"static/chunks/6874-5100f18710e9cb3f.js\",\"61337\",\"static/chunks/61337-fe5b1b874c13fe78.js\",\"68679\",\"static/chunks/68679-e7d59f5e228a6339.js\",\"50794\",\"static/chunks/app/%5Blocale%5D/docs/lay"])</script><script>self.__next_f.push([1,"out-7d507a6a998fafbd.js\"],\"DocsScrollHandler\"]\n23:I[12415,[\"14081\",\"static/chunks/14081-3a328a513f1860b8.js\",\"6874\",\"static/chunks/6874-5100f18710e9cb3f.js\",\"61337\",\"static/chunks/61337-fe5b1b874c13fe78.js\",\"68679\",\"static/chunks/68679-e7d59f5e228a6339.js\",\"50794\",\"static/chunks/app/%5Blocale%5D/docs/layout-7d507a6a998fafbd.js\"],\"PageNavigation\"]\n24:I[79188,[\"14081\",\"static/chunks/14081-3a328a513f1860b8.js\",\"6874\",\"static/chunks/6874-5100f18710e9cb3f.js\",\"61337\",\"static/chunks/61337-fe5b1b874c13fe78.js\",\"68679\",\"static/chunks/68679-e7d59f5e228a6339.js\",\"50794\",\"static/chunks/app/%5Blocale%5D/docs/layout-7d507a6a998fafbd.js\"],\"MobileSectionSelector\"]\n25:I[73005,[\"14081\",\"static/chunks/14081-3a328a513f1860b8.js\",\"66766\",\"static/chunks/66766-93aa4a3d196b6d8b.js\",\"6874\",\"static/chunks/6874-5100f18710e9cb3f.js\",\"92442\",\"static/chunks/92442-3de83d30df656bfc.js\",\"55779\",\"static/chunks/app/%5Blocale%5D/docs/%5B...slug%5D/page-4084506d579935d5.js\"],\"MDXClientRenderer\",1]\n:HL[\"/_next/static/media/1dcb4bb6f2068eb9-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/569ce4b8f30dc480-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/5ed273b77d2a1951-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/62a211a97b43f624-s.p.otf\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/otf\"}]\n:HL[\"/_next/static/media/7cba1811e3c25a15-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/93f479601ee12b01-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/a67ad81cd994aeef-s.p.otf\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/otf\"}]\n:HL[\"/_next/static/media/ab86f138d0d6e9da-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/c7f848bed9dd25a3-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/879b7432ada67782.css\",\"style\"]\n:HL[\"/_next/static/css/e3677c054a3c95bc.css\",\"style\"]\n0:{\"P\":null,\"b\":\"JF1W-bI3MH0cbBK1gPYM6\",\"p\":\"\",\"c\":[\"\",\"en\",\"docs\",\"developers\",\"platform\",\"web-search\"],\"i\":false,\"f\":[[[\"\",{\"children\":[[\"locale\",\"en\",\"d\"],{\"children\":[\"docs\",{\"children\":[[\"slug\",\"developers/platform/web-search\",\"c\"],{\"children\":[\"__PAGE__\",{}]}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/879b7432ada67782.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/e3677c054a3c95bc.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"className\":\"dark __variable_bc0dcf __variable_d28b19 __variable_017788 __variable_2d00a0 __variable_7c1658 __variable_f2a38a __variable_5cfdac __variable_9a8899\",\"children\":[\"$\",\"body\",null,{\"className\":\"antialiased bg-background font-sans\",\"children\":[[\"$\",\"$L2\",null,{\"children\":[\"$\",\"$L3\",null,{\"attribute\":\"class\",\"defaultTheme\":\"system\",\"enableSystem\":true,\"disableTransitionOnChange\":true,\"children\":[\"$\",\"$L4\",null,{\"children\":[\"$\",\"$L5\",null,{\"children\":[[\"$\",\"div\",null,{\"className\":\"relative flex min-h-screen flex-col\",\"children\":[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,"])</script><script>self.__next_f.push([1,"255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}],[\"$\",\"$L8\",null,{}],[\"$\",\"$L9\",null,{}]]}]}]}]}],[\"$\",\"$La\",null,{\"id\":\"structured-data-organization\",\"type\":\"application/ld+json\",\"children\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"Organization\\\",\\\"name\\\":\\\"NullShot\\\",\\\"url\\\":\\\"https://nullshot.ai\\\",\\\"description\\\":\\\"Build The Future Together. Join the future of AI and Web3 innovation with our community-driven platform for decentralized AI governance and collaborative development.\\\",\\\"logo\\\":\\\"https://nullshot.ai/icon.svg\\\",\\\"sameAs\\\":[\\\"https://twitter.com/nullshot_ai\\\",\\\"https://github.com/nullshot\\\"],\\\"contactPoint\\\":{\\\"@type\\\":\\\"ContactPoint\\\",\\\"contactType\\\":\\\"customer service\\\",\\\"url\\\":\\\"https://nullshot.ai\\\"}}\"}],[\"$\",\"$La\",null,{\"id\":\"structured-data-website\",\"type\":\"application/ld+json\",\"children\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"WebSite\\\",\\\"name\\\":\\\"NullShot\\\",\\\"url\\\":\\\"https://nullshot.ai\\\",\\\"description\\\":\\\"Build The Future Together. Join the future of AI and Web3 innovation with our community-driven platform for decentralized AI governance and collaborative development.\\\",\\\"publisher\\\":{\\\"@type\\\":\\\"Organization\\\",\\\"name\\\":\\\"NullShot\\\"},\\\"potentialAction\\\":{\\\"@type\\\":\\\"SearchAction\\\",\\\"target\\\":{\\\"@type\\\":\\\"EntryPoint\\\",\\\"urlTemplate\\\":\\\"https://nullshot.ai/search?q={search_term_string}\\\"},\\\"query-input\\\":\\\"required name=search_term_string\\\"}}\"}]]}]}]]}],{\"children\":[[\"locale\",\"en\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,\"$Lb\"]}],{\"children\":[\"docs\",[\"$\",\"$1\",\"c\",{\"children\":[null,\"$Lc\"]}],{\"children\":[[\"slug\",\"developers/platform/web-search\",\"c\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",\"$Ld\",{},null,false]},null,false]},null,false]},null,false]},null,false],\"$Le\",false]],\"m\":\"$undefined\",\"G\":[\"$f\",[]],\"s\":false,\"S\":false}\nd:[\"$\",\"$1\",\"c\",{\"children\":[\"$L10\",null,[\"$\",\"$L11\",null,{\"children\":[\"$L12\",[\"$\",\"$L13\",null,{\"promise\":\"$@14\"}]]}]]}]\ne:[\"$\",\"$1\",\"h\",{\"children\":[null,[[\"$\",\"$L15\",null,{\"children\":\"$L16\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]],[\"$\",\"$L17\",null,{\"children\":[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$18\",null,{\"fallback\":null,\"children\":\"$L19\"}]}]}]]}]\nb:[\"$\",\"div\",null,{\"className\":\"relative flex min-h-screen flex-col\",\"children\":[[\"$\",\"$L1a\",null,{\"locale\":\"en\"}],[\"$\",\"main\",null,{\"className\":\"flex-1\",\"children\":[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}],[\"$\",\"$L1b\",null,{\"locale\":\"en\"}]]}]\n16:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n12:null\n14:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"Browser Rendering | NullShot\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"Web scraping and content extraction using browser automation for agents\"}],[\"$\",\"meta\",\"2\",{\"name\":\"application-name\",\"content\":\"NullShot\"}],[\"$\",\"meta\",\"3\",{\"name\":\"author\",\"content\":\"NullShot Team\"}],[\"$\",\"link\",\"4\",{\"rel\":\"manifest\",\"href\":\"/manifest.json\",\"crossOrigin\":\"$undefined\"}],[\"$\",\"meta\",\"5\",{\"name\":\"referrer\",\"content\":\"origin-when-cross-origin\"}],[\"$\",\"meta\",\"6\",{\"name\":\"creator\",\""])</script><script>self.__next_f.push([1,"content\":\"NullShot\"}],[\"$\",\"meta\",\"7\",{\"name\":\"publisher\",\"content\":\"NullShot\"}],[\"$\",\"meta\",\"8\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"meta\",\"9\",{\"name\":\"googlebot\",\"content\":\"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1\"}],[\"$\",\"meta\",\"10\",{\"name\":\"category\",\"content\":\"Technology\"}],[\"$\",\"link\",\"11\",{\"rel\":\"canonical\",\"href\":\"https://nullshot.ai/en/docs/developers/platform/web-search\"}],[\"$\",\"link\",\"12\",{\"rel\":\"alternate\",\"hrefLang\":\"en\",\"href\":\"https://nullshot.ai/en/docs/developers/platform/web-search\"}],[\"$\",\"meta\",\"13\",{\"property\":\"og:title\",\"content\":\"Browser Rendering\"}],[\"$\",\"meta\",\"14\",{\"property\":\"og:description\",\"content\":\"Web scraping and content extraction using browser automation for agents\"}],[\"$\",\"meta\",\"15\",{\"property\":\"og:url\",\"content\":\"https://nullshot.ai/en/docs/developers/platform/web-search\"}],[\"$\",\"meta\",\"16\",{\"property\":\"og:site_name\",\"content\":\"Platform Documentation\"}],[\"$\",\"meta\",\"17\",{\"property\":\"og:locale\",\"content\":\"en\"}],[\"$\",\"meta\",\"18\",{\"property\":\"og:image\",\"content\":\"https://nullshot.ai/images/og-image.png\"}],[\"$\",\"meta\",\"19\",{\"property\":\"og:image:width\",\"content\":\"1200\"}],[\"$\",\"meta\",\"20\",{\"property\":\"og:image:height\",\"content\":\"630\"}],[\"$\",\"meta\",\"21\",{\"property\":\"og:image:alt\",\"content\":\"Browser Rendering\"}],[\"$\",\"meta\",\"22\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"23\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"24\",{\"name\":\"twitter:title\",\"content\":\"Browser Rendering\"}],[\"$\",\"meta\",\"25\",{\"name\":\"twitter:description\",\"content\":\"Web scraping and content extraction using browser automation for agents\"}],[\"$\",\"meta\",\"26\",{\"name\":\"twitter:image\",\"content\":\"https://nullshot.ai/images/og-image.png\"}],[\"$\",\"link\",\"27\",{\"rel\":\"icon\",\"href\":\"/icon.svg?423bbdeb1a002565\",\"type\":\"image/svg+xml\",\"sizes\":\"any\"}],[\"$\",\"$L1c\",\"28\",{}]],\"error\":null,\"digest\":\"$undefined\"}\n19:\"$14:metadata\"\n10:[\"$\",\"$L1d\",null,{\"title\":\"Browser Rendering\",\"lastUpdated\":\"$undefined\",\"prevDoc\":{\"title\":\"Storage (R2/S3)\",\"href\":\"/en/docs/developers/platform/storage\"},\"nextDoc\":{\"title\":\"Workflows\",\"href\":\"/en/docs/developers/platform/workflows\"},\"previewNote\":\"$undefined\",\"children\":\"$L1e\"}]\nc:[[\"$\",\"div\",null,{\"className\":\"hidden md:flex h-screen bg-[#16171A] pt-16\",\"children\":[[\"$\",\"div\",null,{\"className\":\"w-64 border-r border-white/10 bg-[#16171A] flex-shrink-0 sticky top-16 h-[calc(100vh-4rem)] overflow-y-auto scrollbar-hide\",\"children\":[\"$\",\"$L1f\",null,{\"docsConfig\":[{\"title\":\"Introduction\",\"items\":[{\"title\":\"Overview\",\"href\":\"/docs/introduction/overview\",\"hasStandalonePage\":true,\"isExpandableOnly\":false},{\"title\":\"Concepts\",\"href\":\"/docs/introduction/concepts\",\"hasStandalonePage\":false,\"isExpandableOnly\":true,\"items\":[{\"title\":\"Agents\",\"href\":\"/docs/introduction/concepts/agents\"},{\"title\":\"AI MCP Tools\",\"href\":\"/docs/introduction/concepts/tools\"},{\"title\":\"Brainstorm\",\"href\":\"/docs/introduction/concepts/brainstorm\"}]}]},{\"title\":\"Protocol\",\"items\":[{\"title\":\"Overview\",\"href\":\"/docs/protocol/overview\",\"hasStandalonePage\":true,\"isExpandableOnly\":false},{\"title\":\"Chains\",\"href\":\"/docs/protocol/chains\",\"hasStandalonePage\":true,\"isExpandableOnly\":false},{\"title\":\"XAVA DAO\",\"href\":\"/docs/protocol/xava\",\"hasStandalonePage\":true,\"isExpandableOnly\":false}]},{\"title\":\"Developers\",\"items\":[{\"title\":\"Platform\",\"href\":\"/docs/developers/platform/overview\",\"hasStandalonePage\":true,\"isExpandableOnly\":false,\"items\":[{\"title\":\"Overview\",\"href\":\"/docs/developers/platform/overview\"},{\"title\":\"Analytics Engine\",\"href\":\"/docs/developers/platform/analytics-engine\"},{\"title\":\"Cache\",\"href\":\"/docs/developers/platform/cache\"},{\"title\":\"Environment Variables\",\"href\":\"/docs/developers/platform/environment-variables\"},{\"title\":\"Memory Store (KV)\",\"href\":\"/docs/developers/platform/memory-store\"},{\"title\":\"Queues\",\"href\":\"/docs/developers/platform/queues\"},{\"title\":\"Secret Manager\",\"href\":\"/docs/developers/platform/secret-manager\"},{\"title\":\"Storage (R2/S3)\",\"href\":\"/docs/developers/platform/storage\"},{\"title\":\"Browser Rendering\",\"href\":\"/docs/developers/plat"])</script><script>self.__next_f.push([1,"form/web-search\"},{\"title\":\"Workflows\",\"href\":\"/docs/developers/platform/workflows\"},{\"title\":\"SQL Database\",\"href\":\"/docs/developers/platform/d1-database\"},{\"title\":\"Vectorize\",\"href\":\"/docs/developers/platform/vectorize\"}]},{\"title\":\"Agents Framework\",\"href\":\"/docs/developers/agents-framework/overview\",\"hasStandalonePage\":true,\"isExpandableOnly\":false,\"items\":[{\"title\":\"Overview\",\"href\":\"/docs/developers/agents-framework/overview\"},{\"title\":\"Getting Started\",\"href\":\"/docs/developers/agents-framework/getting-started\"},{\"title\":\"Sessions\",\"href\":\"/docs/developers/agents-framework/sessions\"},{\"title\":\"Middleware\",\"href\":\"/docs/developers/agents-framework/middleware\"},{\"title\":\"Agent SDK\",\"href\":\"/docs/developers/agents-framework/agent-sdk\"},{\"title\":\"Vercel AI SDK\",\"href\":\"/docs/developers/agents-framework/ai-sdk\"},{\"title\":\"ElizaOS Integration\",\"href\":\"/docs/developers/agents-framework/elizaos\"}]},{\"title\":\"Mcp Framework\",\"href\":\"/docs/developers/mcp-framework/overview\",\"hasStandalonePage\":true,\"isExpandableOnly\":false,\"items\":[{\"title\":\"Overview\",\"href\":\"/docs/developers/mcp-framework/overview\"},{\"title\":\"Getting Started\",\"href\":\"/docs/developers/mcp-framework/getting-started\"},{\"title\":\"TODO List Example\",\"href\":\"/docs/developers/mcp-framework/todo-example\"},{\"title\":\"Integration Testing\",\"href\":\"/docs/developers/mcp-framework/integration-testing\"}]},{\"title\":\"Services\",\"href\":\"/docs/developers/services/overview\",\"hasStandalonePage\":true,\"isExpandableOnly\":false,\"items\":[{\"title\":\"Overview\",\"href\":\"/docs/developers/services/overview\"},{\"title\":\"Toolbox Service\",\"href\":\"/docs/developers/services/toolbox\"},{\"title\":\"External Services\",\"href\":\"/docs/developers/services/external-services\"}]},{\"title\":\"Playground\",\"href\":\"/docs/developers/playground\",\"hasStandalonePage\":true,\"isExpandableOnly\":false}]}]}]}],[\"$\",\"div\",null,{\"id\":\"docs-main-content\",\"className\":\"flex-1 overflow-y-auto scrollbar-hide\",\"children\":[[\"$\",\"$L20\",null,{}],[\"$\",\"div\",null,{\"className\":\"min-h-screen\",\"children\":[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}],[\"$\",\"div\",null,{\"className\":\"w-64 border-l border-white/10 bg-[#16171A] flex-shrink-0\",\"children\":\"$L21\"}]]}],\"$L22\"]\n21:[\"$\",\"div\",null,{\"className\":\"sticky top-0 h-screen overflow-y-auto scrollbar-hide\",\"children\":[\"$\",\"$L23\",null,{}]}]\n22:[\"$\",\"div\",null,{\"className\":\"md:hidden bg-[#14161D] min-h-screen pt-16\",\"children\":[\"$\",\"div\",null,{\"id\":\"docs-main-content-mobile\",\"className\":\"overflow-y-auto\",\"children\":[[\"$\",\"$L20\",null,{}],[\"$\",\"$L24\",null,{\"docsConfig\":\"$c:0:props:children:0:props:children:props:docsConfig\"}],\"$c:0:props:children:1:props:children:1:props:children\"]}]}]\n1e:[\"$\",\"$L25\",null,{\"slug\":[\"developers\",\"platform\",\"web-search\"],\"locale\":\"en\"}]\n"])</script><script id="structured-data-organization" type="application/ld+json" data-nscript="afterInteractive">{"@context":"https://schema.org","@type":"Organization","name":"NullShot","url":"https://nullshot.ai","description":"Build The Future Together. Join the future of AI and Web3 innovation with our community-driven platform for decentralized AI governance and collaborative development.","logo":"https://nullshot.ai/icon.svg","sameAs":["https://twitter.com/nullshot_ai","https://github.com/nullshot"],"contactPoint":{"@type":"ContactPoint","contactType":"customer service","url":"https://nullshot.ai"}}</script><script id="structured-data-website" type="application/ld+json" data-nscript="afterInteractive">{"@context":"https://schema.org","@type":"WebSite","name":"NullShot","url":"https://nullshot.ai","description":"Build The Future Together. Join the future of AI and Web3 innovation with our community-driven platform for decentralized AI governance and collaborative development.","publisher":{"@type":"Organization","name":"NullShot"},"potentialAction":{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"https://nullshot.ai/search?q={search_term_string}"},"query-input":"required name=search_term_string"}}</script><next-route-announcer style="position: absolute;"><template shadowrootmode="open"><div aria-live="assertive" id="__next-route-announcer__" role="alert" style="position: absolute; border: 0px; height: 1px; margin: -1px; padding: 0px; width: 1px; clip: rect(0px, 0px, 0px, 0px); overflow: hidden; white-space: nowrap; overflow-wrap: normal;">Analytics Engine | NullShot</div></template></next-route-announcer></body></html>